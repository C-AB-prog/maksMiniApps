<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>GA · Nova — Social‑style MVP</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* === Design System — Nova (соцсеть‑стиль) === */
    :root{
      --brand:#2563EB;          /* primary */
      --brand-2:#7C3AED;        /* gradient twin */
      --accent:#22C55E;         /* success / accent */
      --bg:#0B1020;             /* deep background */
      --surface:#0F1426;        /* card background */
      --elev:#141B33;           /* elevated stripe */
      --text:#E7ECFF;           /* main text */
      --sub:#9AA4D2;            /* secondary */
      --line:#1D2544;           /* borders */
      --muted:#0C1224;          /* inputs */
      --radius-xl:18px; --radius-lg:14px; --radius-md:12px;
      --shadow-sm:0 8px 28px rgba(0,0,0,.35);
      --shadow-xs:0 3px 10px rgba(0,0,0,.25);
      --h1:24px; --h2:20px; --body:16px; --caption:13px; --micro:12px;
    }
    *, *::before, *::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text);
      background:
        radial-gradient(1200px 600px at 90% -10%, rgba(37,99,235,.18), transparent 55%),
        radial-gradient(900px 500px at -10% 20%, rgba(124,58,237,.14), transparent 45%),
        linear-gradient(180deg, #0A0F1E, #0B1020 40%, #0B1020);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    img,svg{max-width:100%; display:block}
    button,input,select{font:inherit}

    /* Layout */
    .app{min-height:100%; display:flex; flex-direction:column}
    header{position:sticky; top:0; z-index:20; background:rgba(10,15,30,.6); backdrop-filter:saturate(150%) blur(10px); border-bottom:1px solid var(--line)}
    .topbar{display:flex; align-items:center; gap:12px; max-width:980px; margin:0 auto; padding:10px 14px}
    .brand{display:flex; align-items:center; gap:10px}
    .logo{width:30px;height:30px;border-radius:9px; background:linear-gradient(135deg,var(--brand),var(--brand-2)); display:grid;place-items:center; color:#fff; font-weight:700; box-shadow:var(--shadow-xs)}
    .title{font-size:18px; font-weight:700; letter-spacing:.2px}
    .status-pill{margin-left:auto; font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(34,197,94,.14); color:#A7F3D0; border:1px solid rgba(16,185,129,.25)}
    main{flex:1; max-width:980px; width:100%; margin:0 auto; padding:14px 14px 120px}

    /* Cards */
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); border:1px solid var(--line); border-radius:var(--radius-xl); padding:14px; box-shadow:var(--shadow-xs)}
    .card + .card{margin-top:12px}

    /* Story row */
    .stories{display:flex; gap:10px; overflow:auto; padding-bottom:8px}
    .story{flex:0 0 auto; display:flex; flex-direction:column; align-items:center; gap:6px}
    .ring{width:56px;height:56px;border-radius:999px; padding:3px; background:linear-gradient(135deg,var(--brand),var(--brand-2));}
    .ring > .avatar{width:100%;height:100%; border-radius:inherit; display:grid; place-items:center; background:var(--surface); color:#fff; font-weight:700}
    .story span{font-size:12px; color:var(--sub)}

    /* Composer */
    .composer{display:flex; gap:10px; align-items:flex-start; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid var(--line); border-radius:16px; padding:10px}
    .avatar-sm{width:38px;height:38px;border-radius:12px; background:linear-gradient(135deg,var(--brand),var(--brand-2)); display:grid; place-items:center; font-weight:700}
    .input{flex:1; background:var(--muted); border:1px solid var(--line); border-radius:12px; padding:10px 12px; color:var(--text)}
    .input::placeholder{color:#7D86B4}
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{font-size:12px; padding:6px 8px; border-radius:999px; background:rgba(255,255,255,.04); border:1px solid var(--line); color:var(--sub)}

    /* Buttons */
    .btn{height:42px; padding:0 14px; border-radius:12px; border:1px solid transparent; background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#fff; font-weight:600; cursor:pointer; transition:transform .06s ease, box-shadow .12s ease}
    .btn:hover{box-shadow:var(--shadow-sm)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:rgba(255,255,255,.08); color:#E7ECFF; border-color:var(--line)}
    .btn.ghost{background:rgba(255,255,255,.05); color:#E7ECFF; border-color:var(--line)}
    .btn.icon{width:44px; display:grid; place-items:center}

    /* Feed item (пост‑карточка) */
    .feed{display:flex; flex-direction:column; gap:10px}
    .post{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015)); border:1px solid var(--line); border-radius:16px; padding:12px}
    .post-header{display:flex; align-items:center; gap:10px}
    .post-author{font-weight:600}
    .post-meta{color:var(--sub); font-size:12px}
    .post-content{margin-top:8px; color:#E9EDFF; line-height:1.45; overflow-wrap:anywhere; word-break:break-word; hyphens:auto}
    .clamp-2{display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden}
    .post-actions{display:flex; gap:10px; margin-top:8px}
    .action{flex:1; display:flex; align-items:center; gap:8px; justify-content:center; height:38px; border-radius:12px; background:rgba(255,255,255,.04); border:1px solid var(--line); color:#DDE4FF; cursor:pointer}
    .action:active{transform:translateY(1px)}

    /* Task list — соцсеть‑стиль, но с чекбоксом */
    .tasks{display:flex; flex-direction:column; gap:8px}
    .task{display:flex; gap:10px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid var(--line); border-radius:14px; padding:10px; cursor:grab}
    .task:hover{box-shadow:var(--shadow-xs)}
    .task.dragging{opacity:.85}
    .check{position:relative; width:20px; height:20px}
    .check input{appearance:none; -webkit-appearance:none; width:20px; height:20px; border-radius:6px; border:1px solid var(--line); background:rgba(255,255,255,.05); display:grid; place-items:center}
    .check input:checked{background:linear-gradient(135deg,var(--accent),#16A34A); border-color:transparent}
    .t-body{flex:1; min-width:0}
    .t-title{font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .t-sub{color:var(--sub); font-size:12px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .t-right{display:flex; align-items:center; gap:8px}
    .badge{font-size:12px; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid var(--line); color:#C6D1FF; white-space:nowrap}
    .due{font-size:12px; color:#B6C0F0; background:rgba(255,255,255,.06); border:1px solid var(--line); padding:4px 8px; border-radius:999px; white-space:nowrap}
    .menu{border:none; background:transparent; font-size:18px; color:#9AA4D2; cursor:pointer}

    /* Sparkline */
    .sparkline{width:100%; height:40px}

    /* Boards / Calendar / KPI — тёмные, ровные */
    .board{display:grid; grid-template-columns:repeat(4, minmax(240px,1fr)); gap:12px; align-items:start}
    .column{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid var(--line); border-radius:16px; padding:10px; min-height:220px}
    .column h3{font-size:14px; margin:4px 4px 8px; color:#CFD8FF}
    .hadi-card{background:rgba(255,255,255,.03); border:1px solid var(--line); border-radius:12px; padding:10px; margin:8px 4px; cursor:grab}
    .hadi-card.dragging{opacity:.8; box-shadow:var(--shadow-xs)}
    .meta{font-size:12px; color:#B6C0F0}

    .agenda{display:grid; grid-template-columns:80px 1fr; border:1px solid var(--line); border-radius:16px; overflow:hidden}
    .hours{background:#0C1224; border-right:1px solid var(--line)}
    .hour{height:48px; padding:6px 8px; font-size:12px; color:#9AA4D2; border-bottom:1px dashed #1C2447}
    .slots{position:relative}
    .slot{height:48px; border-bottom:1px dashed #1C2447; position:relative}
    .event{position:absolute; left:8px; right:8px; background:rgba(34,197,94,.18); color:#CFFAE2; border:1px solid rgba(34,197,94,.35); border-radius:12px; padding:8px; font-size:12px; box-shadow:var(--shadow-xs)}

    .kpi-grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px}
    .kpi{background:rgba(255,255,255,.03); border:1px solid var(--line); border-radius:16px; padding:12px}
    .kpi .value{font-size:22px; font-weight:700}
    .kpi .delta.up{color:#86EFAC}
    .kpi .delta.down{color:#FCA5A5}
    .bars{height:64px; display:flex; align-items:flex-end; gap:6px}
    .bar{flex:1; background:linear-gradient(180deg, rgba(59,130,246,.28), rgba(59,130,246,.12))}

    /* Bottom nav */
    nav{position:fixed; bottom:0; left:0; right:0; z-index:10; background:rgba(10,15,30,.85); backdrop-filter:blur(10px); border-top:1px solid var(--line); padding:6px env(safe-area-inset-left) calc(6px + env(safe-area-inset-bottom)) env(safe-area-inset-right)}
    .tabs{max-width:980px; margin:0 auto; display:grid; grid-template-columns:repeat(6,1fr); gap:6px}
    .tab{display:flex; flex-direction:column; align-items:center; justify-content:center; height:56px; gap:4px; border-radius:12px; color:#A9B4E6}
    .tab.active{color:#E7ECFF; background:rgba(255,255,255,.06); font-weight:600}

    /* FAB */
    .fab{position:fixed; right:16px; bottom:88px; z-index:30; width:56px; height:56px; border-radius:16px; border:1px solid var(--line); cursor:pointer; background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:#fff; font-size:24px; display:grid; place-items:center; box-shadow:var(--shadow-sm)}
    .fab:active{transform:translateY(1px)}
    .fab-menu{position:fixed; right:16px; bottom:152px; z-index:30; display:flex; flex-direction:column; gap:8px}
    .fab-menu .btn{height:40px; border-radius:12px}

    /* Modal */
    .modal{position:fixed; inset:0; display:grid; place-items:center; background:rgba(3,6,16,.55); backdrop-filter:blur(4px); opacity:0; pointer-events:none; transition:opacity .18s ease}
    .modal[aria-hidden="false"]{opacity:1; pointer-events:auto}
    .dialog{width:min(520px,92vw); max-height:80vh; overflow:auto; background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015)); border-radius:18px; border:1px solid var(--line); box-shadow:var(--shadow-sm); padding:14px}
    .dialog .head{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    .dialog .close{border:1px solid var(--line); background:rgba(255,255,255,.06); width:32px; height:32px; border-radius:10px; cursor:pointer; color:#DDE4FF}

    /* Utilities */
    .row{display:flex; gap:10px; align-items:center}
    .space{flex:1}
    h1{font-size:var(--h1); margin:6px 0 10px}
    h2{font-size:var(--h2); margin:6px 0 10px}

    /* Reduce overflow risk */
    .card, .post, .task{overflow:hidden}

    @media (max-width:420px){ .board{grid-template-columns:1fr 1fr} }
    @media (min-width:768px){ main{padding-bottom:140px} }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo">GA</div>
        <div class="title">Nova</div>
      </div>
      <div class="status-pill" id="status-pill">Online</div>
    </div>
  </header>

  <main>
    <!-- TODAY (соцсеть‑вибы) -->
    <section id="screen-today" class="screen">
      <div class="card">
        <div class="stories">
          <div class="story"><div class="ring"><div class="avatar">🟣</div></div><span>Вы</span></div>
          <div class="story"><div class="ring"><div class="avatar">DA</div></div><span>Design</span></div>
          <div class="story"><div class="ring"><div class="avatar">PM</div></div><span>PM</span></div>
          <div class="story"><div class="ring"><div class="avatar">ML</div></div><span>ML</span></div>
          <div class="story"><div class="ring"><div class="avatar">PR</div></div><span>PR</span></div>
        </div>
        <div class="composer">
          <div class="avatar-sm">GA</div>
          <input class="input" placeholder="Что у вас нового? (задача, заметка, гипотеза)" onclick="openQuickAdd('task')" readonly />
          <button class="btn secondary" onclick="openQuickAdd('task')">Добавить</button>
        </div>
      </div>

      <h1>Лента</h1>
      <div class="feed" id="feed"></div>

      <div class="card" style="margin-top:12px">
        <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:8px">
          <strong>Прогресс недели</strong>
          <span class="badge" id="progressChip">3/7 дней</span>
        </div>
        <svg viewBox="0 0 200 40" class="sparkline" id="spark"></svg>
      </div>
    </section>

    <!-- ROUTE / HADI / CAL / KPI / SETTINGS оставлены, но перерисованы в тёмном стиле -->
    <section id="screen-route" class="screen" hidden>
      <h1>Маршрут</h1>
      <div class="card">
        <div class="row" style="gap:12px; flex-wrap:wrap">
          <span class="badge">Идея</span>
          <span class="badge" style="background:rgba(59,130,246,.18); color:#CFE3FF">Ремесло → Предприниматель</span>
          <span class="badge">Рост</span>
          <span class="space"></span>
          <button class="btn secondary" onclick="aiNextStep()">Следующий шаг (AI)</button>
        </div>
      </div>
      <div class="post"><div class="post-header"><div class="avatar-sm">GA</div><div><div class="post-author">Сформулировать оффер + 5 интервью</div><div class="post-meta">до 26.10 · todo</div></div></div><div class="post-content">Критерий готовности: есть записи/инсайты.</div></div>
      <div class="post"><div class="post-header"><div class="avatar-sm">GA</div><div><div class="post-author">Лендинг оффера</div><div class="post-meta">до 23.10 · doing</div></div></div><div class="post-content">Готово, когда опубликован URL.</div></div>
      <div class="post"><div class="post-header"><div class="avatar-sm">GA</div><div><div class="post-author">Запуск канала трафика №1</div><div class="post-meta">до 24.10 · todo</div></div></div><div class="post-content">Бюджет ≥ 3 000 ₽.</div></div>
    </section>

    <section id="screen-hadi" class="screen" hidden>
      <h1>HADI</h1>
      <div class="board" id="hadiBoard">
        <div class="column" data-col="Planned"><h3>Planned</h3></div>
        <div class="column" data-col="Running"><h3>Running</h3></div>
        <div class="column" data-col="Review"><h3>Review</h3></div>
        <div class="column" data-col="Done"><h3>Done</h3></div>
      </div>
    </section>

    <section id="screen-calendar" class="screen" hidden>
      <h1>Календарь (неделя)</h1>
      <div class="agenda">
        <div class="hours" id="hours"></div>
        <div class="slots" id="slots"></div>
      </div>
    </section>

    <section id="screen-metrics" class="screen" hidden>
      <h1>Метрики</h1>
      <div class="kpi-grid">
        <div class="kpi"><div class="sub">Лиды / неделя</div><div class="value">32 <span class="delta up">▲ +8</span></div><div class="bars" id="bars1"></div></div>
        <div class="kpi"><div class="sub">Конверсия, %</div><div class="value">1.6% <span class="delta up">▲ +0.4</span></div><div class="bars" id="bars2"></div></div>
        <div class="kpi"><div class="sub">Выручка / нед.</div><div class="value">₽ 128 000 <span class="delta down">▼ −12 000</span></div><div class="bars" id="bars3"></div></div>
      </div>
    </section>

    <section id="screen-settings" class="screen" hidden>
      <h1>Настройки</h1>
      <div class="card" style="display:grid; gap:12px">
        <div class="row">
          <div class="avatar-sm">U</div>
          <div class="space"></div>
          <button class="btn ghost">Экспорт CSV</button>
          <button class="btn ghost">PDF (неделя)</button>
        </div>
        <div class="row" style="gap:12px; flex-wrap:wrap">
          <div class="chip">Europe/Helsinki (UTC+3)</div>
          <div class="chip">Уведомления: вкл</div>
          <div class="chip">Подписка: Базовый</div>
        </div>
      </div>
    </section>
  </main>

  <nav>
    <div class="tabs">
      <button class="tab active" data-target="today">🏠<span class="micro">Лента</span></button>
      <button class="tab" data-target="route">🧭<span class="micro">Маршрут</span></button>
      <button class="tab" data-target="hadi">🧪<span class="micro">HADI</span></button>
      <button class="tab" data-target="calendar">🗓️<span class="micro">Календарь</span></button>
      <button class="tab" data-target="metrics">📊<span class="micro">Метрики</span></button>
      <button class="tab" data-target="settings">⚙️<span class="micro">Настройки</span></button>
    </div>
  </nav>
</div>

<!-- FAB + Quick Add menu -->
<button id="fab" class="fab" title="Создать">＋</button>
<div id="fabMenu" class="fab-menu" hidden>
  <button class="btn ghost" onclick="openQuickAdd('task'); toggleFab(false)">Задачу</button>
  <button class="btn ghost" onclick="openQuickAdd('hypothesis'); toggleFab(false)">Гипотезу</button>
  <button class="btn ghost" onclick="openQuickAdd('note'); toggleFab(false)">Заметку</button>
</div>

<!-- Modal -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="head">
      <strong id="modalTitle">Добавить</strong>
      <button class="close" aria-label="Закрыть" onclick="closeModal()">✕</button>
    </div>
    <div class="field"><input id="modalInput" class="input" placeholder="Текст..." /></div>
    <div class="row" style="justify-content:flex-end; margin-top:8px">
      <button class="btn secondary" onclick="closeModal()">Отмена</button>
      <button class="btn" onclick="confirmAdd()">Добавить</button>
    </div>
  </div>
</div>

<script>
  /* --- Mock state --- */
  const state = {
    tasks: [
      { id: 1, title: 'Провести 5 интервью по JTBD', ready:'есть записи/инсайты', due:'26.10', status:'todo' },
      { id: 2, title: 'Лендинг оффера v1', ready:'опубликован URL', due:'23.10', status:'doing' },
      { id: 3, title: 'Запуск канала трафика №1', ready:'вкл. реклама ≥3 000 ₽', due:'24.10', status:'todo' },
    ],
    progress:[2,3,4,2,5,3,4],
    hadi:[
      { id:'h1', col:'Planned', title:'Сегмент X → пробные 8%', H:'оффер Y', A:'лендинг + канал', D:'leads:30, trial:8%', deadline:'27.10' },
      { id:'h2', col:'Running', title:'Визит→лид 1.2%→1.8%', H:'заголовок', A:'A/B', D:'v2l:+0.6', deadline:'25.10' },
      { id:'h3', col:'Review', title:'Реферал‑мини', H:'10% новых', A:'пост + код', D:'ref:10%', deadline:'22.10' },
      { id:'h4', col:'Done', title:'Снизить TTV', H:'быстрее 20%', A:'онбординг', D:'ttv:-20%', deadline:'15.10' },
    ]
  }

  /* Tabs */
  document.querySelectorAll('.tab').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'))
      btn.classList.add('active')
      const target = btn.dataset.target
      document.querySelectorAll('.screen').forEach(s=> s.hidden = true)
      document.getElementById('screen-'+target).hidden = false
      window.scrollTo({ top:0, behavior:'smooth' })
      toggleFab(target==='today')
    })
  })

  /* FEED render — задачи как посты */
  const feed = document.getElementById('feed')
  function renderFeed(){
    feed.innerHTML=''
    state.tasks.forEach(t=>{
      const post = document.createElement('div'); post.className='post'
      post.innerHTML = `
        <div class="post-header">
          <div class="avatar-sm">GA</div>
          <div>
            <div class="post-author clamp-2">${t.title}</div>
            <div class="post-meta">до ${t.due} · ${t.status}</div>
          </div>
          <span class="space"></span>
          <button class="menu" onclick="openTaskMenu(${t.id}, this)">⋯</button>
        </div>
        <div class="post-content clamp-2">Готово, когда ${t.ready}</div>
        <div class="post-actions">
          <div class="action" onclick="toggleDone(${t.id})">✅ Готово</div>
          <div class="action" onclick="openQuickAdd('note')">✍️ Заметка</div>
          <div class="action" onclick="shiftDue(${t.id},1)">⏭ На завтра</div>
        </div>`
      addDragHandlers(post, state.tasks, (a,b)=>a.id===b.id, renderFeed)
      feed.appendChild(post)
    })
  }

  function toggleDone(id){ const t=state.tasks.find(x=>x.id===id); if(!t) return; t.status = t.status==='done'?'todo':'done'; toast(t.status==='done'?'Задача выполнена':'Вернули в работу'); renderFeed() }

  /* Context menu for posts */
  function openTaskMenu(id, btn){
    const menu = document.createElement('div')
    menu.style.cssText = 'position:absolute;background:rgba(10,15,30,.96);border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow-sm);padding:6px;z-index:40'
    const actions=[ ['Разбить на 2 шага', ()=>splitTask(id)], ['Удалить', ()=>removeTask(id)] ]
    actions.forEach(([label,fn])=>{ const it=document.createElement('button'); it.className='btn secondary'; it.style.width='100%'; it.style.margin='4px 0'; it.textContent=label; it.onclick=()=>{fn(); menu.remove()} ; menu.appendChild(it) })
    document.body.appendChild(menu)
    const rect = btn.getBoundingClientRect(); const mw = 220; const left = Math.min(window.innerWidth - mw - 12, Math.max(12, rect.left - 160)); menu.style.left = left + 'px'; menu.style.top = (rect.bottom + window.scrollY + 8) + 'px'
    const onClick=e=>{ if(!menu.contains(e.target)) {menu.remove(); document.removeEventListener('click', onClick)} }
    setTimeout(()=>document.addEventListener('click', onClick),0)
  }
  function splitTask(id){ toast('Созданы подзадачи (демо)') }
  function removeTask(id){ state.tasks = state.tasks.filter(t=>t.id!==id); renderFeed(); toast('Удалено') }
  function shiftDue(id, days){ toast('Дедлайн перенесён') }

  /* Drag helper */
  function addDragHandlers(el, list, eq, rerender){ let dragIndex; el.draggable = true; el.addEventListener('dragstart', e=>{ el.classList.add('dragging'); dragIndex = [...el.parentNode.children].indexOf(el) }); el.addEventListener('dragend', e=>{ el.classList.remove('dragging') }); el.addEventListener('dragover', e=>{ e.preventDefault(); const over = e.currentTarget; const overIndex = [...over.parentNode.children].indexOf(over); const dragging = over.parentNode.querySelector('.dragging'); if(!dragging || dragging===over) return; if(overIndex>dragIndex) over.after(dragging); else over.before(dragging) }); el.addEventListener('drop', e=>{ const ids = [...el.parentNode.children].map(n=>+n.dataset.id).filter(Boolean); if(!ids.length){ /* feed items have no ids */ rerender(); return } list.sort((a,b)=> ids.indexOf(a.id) - ids.indexOf(b.id)); rerender() }) }

  /* Sparkline */
  function renderSpark(){ const svg = document.getElementById('spark'); const w=200, h=40; const max=Math.max(...state.progress); const pts = state.progress.map((v,i)=>[i*(w/(state.progress.length-1)), h - (v/max)*(h-6) - 3]); const d = pts.map((p,i)=> (i?'L':'M')+p[0]+','+p[1]).join(' '); const color = getComputedStyle(document.documentElement).getPropertyValue('--brand').trim() || '#3B82F6'; svg.innerHTML = `<path d="${d}" fill="none" stroke="${color}" stroke-width="2"/><circle cx="${pts[pts.length-1][0]}" cy="${pts[pts.length-1][1]}" r="3" fill="${color}"/>` }

  /* HADI board */
  function renderHADI(){ const cols = document.querySelectorAll('.column'); cols.forEach(c=> c.querySelectorAll('.hadi-card').forEach(n=>n.remove())); state.hadi.forEach(card=>{ const el = document.createElement('div'); el.className='hadi-card'; el.draggable=true; el.dataset.id=card.id; el.innerHTML = `<div style="font-weight:600; margin-bottom:4px">${card.title}</div><div class="meta">H: ${card.H}</div><div class="meta">A: ${card.A}</div><div class="meta">D: ${card.D}</div><div class="meta">Дедлайн: ${card.deadline}</div>`; el.addEventListener('dragstart',()=> el.classList.add('dragging')); el.addEventListener('dragend',()=> el.classList.remove('dragging')); document.querySelector(`.column[data-col="${card.col}"]`).appendChild(el) }); document.querySelectorAll('.column').forEach(col=>{ col.addEventListener('dragover', e=>{ e.preventDefault(); const dragging = document.querySelector('.hadi-card.dragging'); if(!dragging) return; col.appendChild(dragging) }); col.addEventListener('drop', e=>{ const dragging = col.querySelector('.hadi-card.dragging'); if(!dragging) return; const id = dragging.dataset.id; const card = state.hadi.find(x=>x.id===id); card.col = col.dataset.col; toast(`Статус: ${card.col}`) }) }) }

  /* Agenda */
  function renderAgenda(){ const hours = document.getElementById('hours'); const slots = document.getElementById('slots'); hours.innerHTML = ''; slots.innerHTML=''; for(let h=9; h<=18; h++){ const hour = document.createElement('div'); hour.className='hour'; hour.textContent = (h<10?'0':'')+h+':00'; hours.appendChild(hour); const slot = document.createElement('div'); slot.className='slot'; slot.dataset.h=h; slots.appendChild(slot) } addEvent(10, 1, 'Интервью #1'); addEvent(11, 1, 'Интервью #2'); addEvent(15, 2, 'Лендинг — правки') }
  function addEvent(startHour, duration, title){ const slots = document.getElementById('slots'); const ev = document.createElement('div'); ev.className='event'; ev.style.top = ( (startHour-9)*48 + 6) + 'px'; ev.style.height = (duration*48 - 12) + 'px'; ev.textContent = title; slots.appendChild(ev) }

  /* KPI bars */
  function renderBars(id, values){ const el = document.getElementById(id); el.innerHTML=''; values.forEach(v=>{ const b=document.createElement('div'); b.className='bar'; b.style.height=(10+v*8)+'px'; el.appendChild(b) }) }

  /* Modal control */
  const modal = document.getElementById('modal')
  function openQuickAdd(type){ currentAddType = type; document.getElementById('modalTitle').textContent = {task:'Новая задача', hypothesis:'Новая гипотеза', note:'Новая заметка'}[type]; document.getElementById('modalInput').value=''; showModal() }
  function showModal(){ modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; setTimeout(()=>document.getElementById('modalInput').focus(), 0) }
  function closeModal(){ modal.setAttribute('aria-hidden','true'); document.body.style.overflow='' }
  modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal() })
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal() })

  /* Modal add */
  let currentAddType = 'task'
  function confirmAdd(){ const val = document.getElementById('modalInput').value.trim(); if(!val) return closeModal(); if(currentAddType==='task'){ state.tasks.unshift({ id:Date.now(), title:val, due:'—', ready:'критерий', status:'todo' }); renderFeed() } else if(currentAddType==='hypothesis'){ toast('Гипотеза создана (демо)') } closeModal(); toast('Добавлено') }

  /* FAB */
  const fab = document.getElementById('fab'); const menu = document.getElementById('fabMenu')
  function toggleFab(show){ if(show===undefined) show = menu.hidden; menu.hidden = !show }
  fab.addEventListener('click', ()=> toggleFab())
  document.addEventListener('click', (e)=>{ if(!menu.hidden && !menu.contains(e.target) && e.target!==fab) menu.hidden = true })

  /* Toast */
  function toast(msg){ const t = document.createElement('div'); t.textContent = msg; t.style.cssText = 'position:fixed;bottom:86px;left:50%;transform:translateX(-50%);background:rgba(7,11,24,.95);color:#E7ECFF;padding:10px 14px;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow-xs);opacity:.98;z-index:99'; document.body.appendChild(t); setTimeout(()=>{t.style.transition='opacity .4s'; t.style.opacity='0'; setTimeout(()=>t.remove(), 400)}, 900) }

  /* Init */
  function init(){ renderFeed(); renderSpark(); renderHADI(); renderAgenda(); renderBars('bars1',[2,3,4,5,3,4,6]); renderBars('bars2',[1,1,2,2,3,3,4]); renderBars('bars3',[4,3,5,6,5,4,3]); toggleFab(true); closeModal() }
  init()
</script>
</body>
</html>
