<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Growth Assistant ¬∑ Mini‚ÄëApp (MVP Demo)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* –ß–∏—Å—Ç—ã–π, –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π UI‚Äë–Ω–∞–±–æ—Ä */
      --ga-green:#2E7D32; /* primary */
      --ga-green-2:#3FB950; /* gradient */
      --ga-blue:#1E88E5;  /* accent  */
      --ga-success:#22C55E;
      --ga-error:#EF4444;
      --ga-bg:#FFFFFF;
      --ga-surface:#FFFFFF;
      --ga-text:#111827;
      --ga-subtext:#6B7280;
      --ga-border:#E5E7EB;
      --muted:#F3F4F6;
      --radius-xl:18px; --radius-lg:14px; --radius-md:12px;
      --shadow-xs:0 1px 2px rgba(0,0,0,.04);
      --shadow-sm:0 6px 20px rgba(0,0,0,.06);
      --shadow-md:0 12px 28px rgba(0,0,0,.10);
      --h1:24px; --h2:20px; --body:16px; --caption:13px; --micro:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--ga-text); background:var(--ga-bg); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
    .app{min-height:100%; display:flex; flex-direction:column}

    /* Header */
    header{position:sticky; top:0; z-index:20; background:rgba(255,255,255,.85); backdrop-filter:blur(8px); border-bottom:1px solid var(--ga-border); padding:8px env(safe-area-inset-left) 8px env(safe-area-inset-right)}
    .topbar{display:flex; align-items:center; gap:12px; max-width:960px; margin:0 auto; padding:0 12px}
    .brand{display:flex; align-items:center; gap:10px}
    .logo{width:28px;height:28px;border-radius:9px; background:linear-gradient(135deg,var(--ga-green),var(--ga-green-2)); display:grid;place-items:center; color:#fff; font-weight:700; box-shadow:var(--shadow-xs)}
    .title{font-size:18px; font-weight:700; letter-spacing:.2px}
    .status-pill{margin-left:auto; font-size:12px; padding:6px 10px; border-radius:999px; background:#EAF6ED; color:var(--ga-green); border:1px solid #D3EBD7}

    main{flex:1; max-width:960px; width:100%; margin:0 auto; padding:12px 12px 120px}

    /* Cards */
    .card{background:var(--ga-surface); border:1px solid var(--ga-border); border-radius:var(--radius-xl); padding:14px; box-shadow:var(--shadow-xs)}
    .card + .card{margin-top:12px}

    /* Focus */
    .focus-banner{display:flex; flex-direction:column; gap:10px; background:linear-gradient(180deg,#ffffff, #fafafa); border:1px solid #EFF2F4}
    .focus-row{display:flex; gap:10px; align-items:center}
    input[type="text"].focus-input{flex:1; border:1px solid var(--ga-border); border-radius:14px; padding:12px; font-size:16px; background:#fff}

    /* Buttons */
    .btn{height:44px; padding:0 14px; border-radius:14px; border:1px solid transparent; background:linear-gradient(135deg,var(--ga-green),var(--ga-green-2)); color:#fff; font-weight:600; cursor:pointer; transition:transform .06s ease, box-shadow .12s ease}
    .btn:hover{box-shadow:var(--shadow-sm)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#F0F7FE; color:#1366B8; border-color:#D6E8FF}
    .btn.ghost{background:#fff; color:#374151; border-color:var(--ga-border)}
    .btn.icon{width:44px; display:grid; place-items:center}
    .muted{color:var(--ga-subtext)}

    /* Tasks */
    .tasks{display:flex; flex-direction:column; gap:8px}
    .task{display:flex; align-items:center; gap:10px; background:#fff; border:1px solid var(--ga-border); border-radius:14px; padding:10px; transition:box-shadow .12s ease, transform .08s ease; cursor:grab}
    .task:hover{box-shadow:var(--shadow-xs)}
    .task:active{transform:scale(.998)}
    .task.dragging{opacity:.75; box-shadow:var(--shadow-md)}
    .task .title{font-weight:600}
    .task .due{margin-left:auto; font-size:12px; color:#334155; background:#EEF2F4; padding:6px 8px; border-radius:999px}
    .task .menu{margin-left:4px; border:none; background:transparent; font-size:18px; color:#9CA3AF; cursor:pointer}
    .chip{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--ga-border); background:#F9FAFB; color:#475569}

    /* Empty state */
    .empty{display:grid; place-items:center; text-align:center; gap:10px; padding:24px; color:#6B7280}
    .empty .illu{font-size:32px}

    /* Sparkline */
    .sparkline{width:100%; height:40px}

    /* Route */
    .route-stage{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
    .stage{display:flex; align-items:center; gap:8px}
    .stage .dot{width:8px;height:8px;border-radius:50%; background:#CBD5E1}
    .stage.active .dot{background:var(--ga-blue)}
    .step{display:flex; gap:10px; align-items:flex-start}
    .badge{font-size:12px; padding:6px 8px; border-radius:999px; background:#E3F2FD; color:#1565C0; border:1px solid #BBDEFB}

    /* HADI */
    .board{display:grid; grid-template-columns:repeat(4, minmax(240px,1fr)); gap:12px; align-items:start}
    .column{background:var(--ga-surface); border:1px solid var(--ga-border); border-radius:16px; padding:10px; min-height:220px}
    .column h3{font-size:14px; margin:4px 4px 8px}
    .hadi-card{background:#fff; border:1px solid var(--ga-border); border-radius:12px; padding:10px; margin:8px 4px; cursor:grab}
    .hadi-card.dragging{opacity:.7; box-shadow:var(--shadow-sm)}
    .meta{font-size:12px; color:#546E7A}

    /* Calendar */
    .agenda{display:grid; grid-template-columns:80px 1fr; border:1px solid var(--ga-border); border-radius:16px; overflow:hidden}
    .hours{background:#F9FAFB; border-right:1px solid var(--ga-border)}
    .hour{height:48px; padding:6px 8px; font-size:12px; color:#6B7280; border-bottom:1px dashed #ECEFF1}
    .slots{position:relative}
    .slot{height:48px; border-bottom:1px dashed #F1F3F4; position:relative}
    .event{position:absolute; left:8px; right:8px; background:#E8F5E9; color:#1B5E20; border:1px solid #C8E6C9; border-radius:12px; padding:8px; font-size:12px; box-shadow:var(--shadow-xs)}

    /* Metrics */
    .kpi-grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px}
    .kpi{background:#fff; border:1px solid var(--ga-border); border-radius:16px; padding:12px}
    .kpi .value{font-size:22px; font-weight:700}
    .kpi .delta.up{color:var(--ga-success)}
    .kpi .delta.down{color:var(--ga-error)}
    .bars{height:64px; display:flex; align-items:flex-end; gap:6px}
    .bar{flex:1; background:#E3F2FD}

    /* Settings */
    .form{display:grid; grid-template-columns:1fr; gap:12px}
    .field{display:flex; flex-direction:column; gap:6px}
    .field input, .field select{height:44px; padding:0 12px; border-radius:12px; border:1px solid var(--ga-border); background:#fff}
    .switch{display:flex; align-items:center; gap:10px}

    /* Bottom nav */
    nav{position:fixed; bottom:0; left:0; right:0; z-index:10; background:rgba(255,255,255,.9); backdrop-filter:blur(8px); border-top:1px solid var(--ga-border); padding:6px env(safe-area-inset-left) calc(6px + env(safe-area-inset-bottom)) env(safe-area-inset-right)}
    .tabs{max-width:960px; margin:0 auto; display:grid; grid-template-columns:repeat(6,1fr); gap:6px}
    .tab{display:flex; flex-direction:column; align-items:center; justify-content:center; height:56px; gap:4px; border-radius:12px; color:#64748B}
    .tab.active{color:var(--ga-green); background:#E8F5E9; font-weight:600}

    /* FAB */
    .fab{position:fixed; right:16px; bottom:88px; z-index:30; width:56px; height:56px; border-radius:50%; border:none; cursor:pointer; background:linear-gradient(135deg,var(--ga-green),var(--ga-green-2)); color:#fff; font-size:24px; display:grid; place-items:center; box-shadow:var(--shadow-md)}
    .fab:active{transform:translateY(1px)}
    .fab-menu{position:fixed; right:16px; bottom:152px; z-index:30; display:flex; flex-direction:column; gap:8px}
    .fab-menu .btn{height:40px; border-radius:12px}

    /* Modal */
    .modal{position:fixed; inset:0; display:grid; place-items:center; background:rgba(17,24,39,.4); backdrop-filter:blur(4px); opacity:0; pointer-events:none; transition:opacity .18s ease}
    .modal[aria-hidden="false"]{opacity:1; pointer-events:auto}
    .dialog{width:min(520px,92vw); background:#fff; border-radius:18px; border:1px solid var(--ga-border); box-shadow:var(--shadow-md); padding:14px}
    .dialog .head{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    .dialog .close{border:none; background:#F3F4F6; width:32px; height:32px; border-radius:10px; cursor:pointer; color:#6B7280}

    /* Utilities */
    .row{display:flex; gap:10px; align-items:center}
    .space{flex:1}
    h1{font-size:var(--h1); margin:6px 0 10px}
    h2{font-size:var(--h2); margin:6px 0 10px}

    @media (max-width:420px){ .board{grid-template-columns:1fr 1fr} }
    @media (min-width:768px){ main{padding-bottom:140px} }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="logo">GA</div>
        <div class="title">Growth Assistant</div>
      </div>
      <div class="status-pill" id="status-pill">Working</div>
    </div>
  </header>

  <main>
    <!-- TODAY -->
    <section id="screen-today" class="screen">
      <h1>–°–µ–≥–æ–¥–Ω—è</h1>
      <div class="card focus-banner">
        <div class="row focus-row">
          <input id="focusInput" class="focus-input" placeholder="–§–æ–∫—É—Å –¥–Ω—è" value="5 –∏–Ω—Ç–µ—Ä–≤—å—é –∫–ª–∏–µ–Ω—Ç–æ–≤ + –ª–µ–Ω–¥–∏–Ω–≥" />
          <button class="btn" onclick="saveFocus()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn secondary" onclick="snooze()">Snooze</button>
        </div>
        <div class="muted" id="focusMeta">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ 09:00 ‚Ä¢ –Ω–µ–¥. –ø–ª–∞–Ω—ë—Ä–∫–∞: –ü—Ç 17:30</div>
      </div>

      <h2>–¢–æ–ø‚Äë3 –∑–∞–¥–∞—á–∏</h2>
      <div id="taskList" class="tasks" aria-label="–ü–µ—Ä–µ—Ç–∞—â–∏, —á—Ç–æ–±—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"></div>

      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:8px">
          <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–¥–µ–ª–∏</strong>
          <span class="chip" id="progressChip">3/7 –¥–Ω–µ–π</span>
        </div>
        <svg viewBox="0 0 200 40" class="sparkline" id="spark"></svg>
      </div>
    </section>

    <!-- ROUTE -->
    <section id="screen-route" class="screen" hidden>
      <h1>–ú–∞—Ä—à—Ä—É—Ç</h1>
      <div class="card route-stage">
        <div class="stage"><span class="dot"></span>–ò–¥–µ—è</div>
        <div class="stage active"><span class="dot"></span>–†–µ–º–µ—Å–ª–æ ‚Üí –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å</div>
        <div class="stage"><span class="dot"></span>–†–æ—Å—Ç</div>
        <span class="space"></span>
        <button class="btn secondary" onclick="aiNextStep()">–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (AI)</button>
      </div>
      <div class="card step">
        <div class="badge">todo</div>
        <div>
          <div class="title"><strong>–°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ—Ñ–µ—Ä + –Ω–∞–∑–Ω–∞—á–∏—Ç—å 5 –∏–Ω—Ç–µ—Ä–≤—å—é</strong></div>
          <div class="meta">–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏: –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏/–∏–Ω—Å–∞–π—Ç—ã ‚Ä¢ –î–µ–¥–ª–∞–π–Ω: 26.10</div>
        </div>
      </div>
      <div class="card step">
        <div class="badge" style="background:#E8F5E9; color:#1B5E20; border-color:#C8E6C9">doing</div>
        <div>
          <div class="title"><strong>–õ–µ–Ω–¥–∏–Ω–≥ –æ—Ñ—Ñ–µ—Ä–∞</strong></div>
          <div class="meta">–ì–æ—Ç–æ–≤–æ, –∫–æ–≥–¥–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω URL ‚Ä¢ –î–µ–¥–ª–∞–π–Ω: 23.10</div>
        </div>
      </div>
      <div class="card step">
        <div class="badge" style="background:#E3F2FD; color:#1565C0; border-color:#BBDEFB">todo</div>
        <div>
          <div class="title"><strong>–ó–∞–ø—É—Å–∫ –∫–∞–Ω–∞–ª–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Ññ1</strong></div>
          <div class="meta">–ë—é–¥–∂–µ—Ç ‚â• 3‚ÄØ000 ‚ÇΩ ‚Ä¢ –î–µ–¥–ª–∞–π–Ω: 24.10</div>
        </div>
      </div>
    </section>

    <!-- HADI -->
    <section id="screen-hadi" class="screen" hidden>
      <h1>HADI</h1>
      <div class="board" id="hadiBoard">
        <div class="column" data-col="Planned"><h3>Planned</h3></div>
        <div class="column" data-col="Running"><h3>Running</h3></div>
        <div class="column" data-col="Review"><h3>Review</h3></div>
        <div class="column" data-col="Done"><h3>Done</h3></div>
      </div>
    </section>

    <!-- CALENDAR -->
    <section id="screen-calendar" class="screen" hidden>
      <h1>–ö–∞–ª–µ–Ω–¥–∞—Ä—å (–Ω–µ–¥–µ–ª—è)</h1>
      <div class="agenda">
        <div class="hours" id="hours"></div>
        <div class="slots" id="slots"></div>
      </div>
      <div style="margin-top:10px" class="muted">OAuth –∫ Google Calendar / iCal –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏.</div>
    </section>

    <!-- METRICS -->
    <section id="screen-metrics" class="screen" hidden>
      <h1>–ú–µ—Ç—Ä–∏–∫–∏</h1>
      <div class="kpi-grid">
        <div class="kpi">
          <div class="muted">–õ–∏–¥—ã / –Ω–µ–¥–µ–ª—è</div>
          <div class="value">32 <span class="delta up">‚ñ≤ +8</span></div>
          <div class="bars" id="bars1"></div>
        </div>
        <div class="kpi">
          <div class="muted">–ö–æ–Ω–≤–µ—Ä—Å–∏—è, %</div>
          <div class="value">1.6% <span class="delta up">‚ñ≤ +0.4</span></div>
          <div class="bars" id="bars2"></div>
        </div>
        <div class="kpi">
          <div class="muted">–í—ã—Ä—É—á–∫–∞ / –Ω–µ–¥.</div>
          <div class="value">‚ÇΩ 128‚ÄØ000 <span class="delta down">‚ñº ‚àí12‚ÄØ000</span></div>
          <div class="bars" id="bars3"></div>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="screen-settings" class="screen" hidden>
      <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
      <div class="card form">
        <div class="field">
          <label>–ò–º—è</label>
          <input placeholder="–ò–º—è" value="–î–º–∏—Ç—Ä–∏–π" />
        </div>
        <div class="field">
          <label>–¢–∞–π–º–∑–æ–Ω–∞</label>
          <select>
            <option>Europe/Helsinki (UTC+3)</option>
            <option>Europe/Moscow (UTC+3)</option>
            <option>Asia/Almaty (UTC+6)</option>
          </select>
        </div>
        <div class="switch">
          <input type="checkbox" id="notif" checked />
          <label for="notif">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
        </div>
        <div class="row">
          <button class="btn">–ü–æ–¥–ø–∏—Å–∫–∞: –ë–∞–∑–æ–≤—ã–π ¬∑ 990 ‚ÇΩ</button>
          <button class="btn secondary">–°–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ</button>
        </div>
        <div class="row">
          <button class="btn ghost">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Google Calendar</button>
          <button class="btn ghost">–î–æ–±–∞–≤–∏—Ç—å iCal URL</button>
        </div>
        <div class="row">
          <button class="btn ghost">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
          <button class="btn ghost">–≠–∫—Å–ø–æ—Ä—Ç PDF (–Ω–µ–¥–µ–ª—è)</button>
        </div>
      </div>
    </section>
  </main>

  <nav>
    <div class="tabs">
      <button class="tab active" data-target="today">üè†<span class="micro">–°–µ–≥–æ–¥–Ω—è</span></button>
      <button class="tab" data-target="route">üß≠<span class="micro">–ú–∞—Ä—à—Ä—É—Ç</span></button>
      <button class="tab" data-target="hadi">üß™<span class="micro">HADI</span></button>
      <button class="tab" data-target="calendar">üóìÔ∏è<span class="micro">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
      <button class="tab" data-target="metrics">üìä<span class="micro">–ú–µ—Ç—Ä–∏–∫–∏</span></button>
      <button class="tab" data-target="settings">‚öôÔ∏è<span class="micro">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
    </div>
  </nav>
</div>

<!-- FAB + Quick Add menu -->
<button id="fab" class="fab" title="–î–æ–±–∞–≤–∏—Ç—å">Ôºã</button>
<div id="fabMenu" class="fab-menu" hidden>
  <button class="btn ghost" onclick="openQuickAdd('task'); toggleFab(false)">–ó–∞–¥–∞—á—É</button>
  <button class="btn ghost" onclick="openQuickAdd('hypothesis'); toggleFab(false)">–ì–∏–ø–æ—Ç–µ–∑—É</button>
  <button class="btn ghost" onclick="openQuickAdd('note'); toggleFab(false)">–ó–∞–º–µ—Ç–∫—É</button>
</div>

<!-- Modal -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="head">
      <strong id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å</strong>
      <button class="close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" onclick="closeModal()">‚úï</button>
    </div>
    <div class="field">
      <input id="modalInput" placeholder="–¢–µ–∫—Å—Ç..." />
    </div>
    <div class="row" style="justify-content:flex-end; margin-top:8px">
      <button class="btn secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn" onclick="confirmAdd()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
  const state = {
    focus: '5 –∏–Ω—Ç–µ—Ä–≤—å—é –∫–ª–∏–µ–Ω—Ç–æ–≤ + –ª–µ–Ω–¥–∏–Ω–≥',
    reminders: { daily_focus_time: '09:00', weekly_planning_slot: '–ü—Ç 17:30' },
    tasks: [
      { id: 1, title: '–ü—Ä–æ–≤–µ—Å—Ç–∏ 5 –∏–Ω—Ç–µ—Ä–≤—å—é', due: '26.10', ready: '–µ—Å—Ç—å –∑–∞–ø–∏—Å–∏/–∏–Ω—Å–∞–π—Ç—ã', status:'todo' },
      { id: 2, title: '–°–≤–µ—Ä—Å—Ç–∞—Ç—å –ª–µ–Ω–¥–∏–Ω–≥ –æ—Ñ—Ñ–µ—Ä–∞', due: '23.10', ready: '–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω URL', status:'doing' },
      { id: 3, title: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–Ω–∞–ª —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Ññ1', due: '24.10', ready: '–≤–∫–ª. —Ä–µ–∫–ª–∞–º–∞ ‚â•3‚ÄØ000 ‚ÇΩ', status:'todo' },
    ],
    progress: [2,3,4,2,5,3,4],
    hadi: [
      { id:'h1', col:'Planned', title:'–°–µ–≥–º–µ–Ω—Ç X ‚Üí –ø—Ä–æ–±–Ω—ã–µ 8%', H:'–æ—Ñ—Ñ–µ—Ä Y', A:'–ª–µ–Ω–¥–∏–Ω–≥ + –∫–∞–Ω–∞–ª', D:'leads:30, trial:8%', deadline:'27.10' },
      { id:'h2', col:'Running', title:'–ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤–∏–∑–∏—Ç‚Üí–ª–∏–¥ 1.2%‚Üí1.8%', H:'—É–ª—É—á—à–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫', A:'A/B', D:'v2l:+0.6', deadline:'25.10' },
      { id:'h3', col:'Review', title:'–†–µ—Ñ–µ—Ä–∞–ª‚Äë–º–∏–Ω–∏', H:'10% –Ω–æ–≤—ã—Ö –∏–∑ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤', A:'–ø–æ—Å—Ç + –∫–æ–¥', D:'ref:10%', deadline:'22.10' },
      { id:'h4', col:'Done', title:'–°–æ–∫—Ä–∞—Ç–∏—Ç—å TTV', H:'–±—ã—Å—Ç—Ä–µ–µ 20%', A:'–æ–Ω–±–æ—Ä–¥–∏–Ω–≥', D:'ttv:-20%', deadline:'15.10' },
    ]
  }

  /* Tabs */
  document.querySelectorAll('.tab').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'))
      btn.classList.add('active')
      const target = btn.dataset.target
      document.querySelectorAll('.screen').forEach(s=> s.hidden = true)
      document.getElementById('screen-'+target).hidden = false
      window.scrollTo({ top:0, behavior:'smooth' })
      toggleFab(target==='today')
    })
  })

  /* Focus */
  function saveFocus(){ state.focus = document.getElementById('focusInput').value.trim() || state.focus; toast('–§–æ–∫—É—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω') }
  function snooze(){ toast('–ù–∞–ø–æ–º–Ω—é —á–µ—Ä–µ–∑ 3 —á–∞—Å–∞') }

  /* Tasks */
  const taskList = document.getElementById('taskList')
  function renderTasks(){
    taskList.innerHTML = ''
    if(!state.tasks.length){
      const empty = document.createElement('div'); empty.className = 'card empty';
      empty.innerHTML = `<div class="illu">‚ú®</div><div>–ó–¥–µ—Å—å –±—É–¥—É—Ç –∑–∞–¥–∞—á–∏ –¥–Ω—è</div>`
      const b = document.createElement('button'); b.className='btn'; b.textContent='–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É'; b.onclick=()=>openQuickAdd('task')
      empty.appendChild(b); taskList.appendChild(empty); return
    }
    state.tasks.forEach(t=>{
      const el = document.createElement('div'); el.className = 'task'; el.draggable = true; el.dataset.id = t.id
      el.innerHTML = `
        <input type="checkbox" ${t.status==='done'?'checked':''} onchange="toggleDone(${t.id}, this.checked)">
        <div>
          <div class="title">${t.title}</div>
          <div class="muted">–ì–æ—Ç–æ–≤–æ, –∫–æ–≥–¥–∞ ${t.ready}</div>
        </div>
        <span class="chip">${t.status}</span>
        <span class="due">–¥–æ ${t.due}</span>
        <button class="menu" onclick="openTaskMenu(${t.id}, this)">‚ãØ</button>`
      addDragHandlers(el, state.tasks, (a,b)=>a.id===b.id, renderTasks)
      taskList.appendChild(el)
    })
  }
  function toggleDone(id, checked){ const t = state.tasks.find(x=>x.id===id); if(!t) return; t.status = checked ? 'done' : 'todo'; toast(checked?'–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞':'–í–µ—Ä–Ω—É–ª–∏ –≤ —Ä–∞–±–æ—Ç—É') }
  function openTaskMenu(id, btn){
    const menu = document.createElement('div')
    menu.style.cssText = 'position:absolute;background:#fff;border:1px solid var(--ga-border);border-radius:12px;box-shadow:var(--shadow-sm);padding:6px;'
    const actions=[ ['–°–¥–≤–∏–Ω—É—Ç—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞', ()=>shiftDue(id,1)], ['–†–∞–∑–±–∏—Ç—å –Ω–∞ 2 —à–∞–≥–∞', ()=>splitTask(id)], ['–£–¥–∞–ª–∏—Ç—å', ()=>removeTask(id)] ]
    actions.forEach(([label,fn])=>{ const it=document.createElement('button'); it.className='btn ghost'; it.style.width='100%'; it.style.margin='4px 0'; it.textContent=label; it.onclick=()=>{fn(); menu.remove()} ; menu.appendChild(it) })
    const rect = btn.getBoundingClientRect(); menu.style.left = Math.max(12, rect.left - 160) + 'px'; menu.style.top = (rect.bottom + window.scrollY + 8) + 'px'
    document.body.appendChild(menu)
    const onClick=e=>{ if(!menu.contains(e.target)) {menu.remove(); document.removeEventListener('click', onClick)} }
    setTimeout(()=>document.addEventListener('click', onClick),0)
  }
  function shiftDue(id, days){ toast('–î–µ–¥–ª–∞–π–Ω –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω') }
  function splitTask(id){ toast('–°–æ–∑–¥–∞–Ω—ã –ø–æ–¥–∑–∞–¥–∞—á–∏ (–¥–µ–º–æ)') }
  function removeTask(id){ state.tasks = state.tasks.filter(t=>t.id!==id); renderTasks(); toast('–£–¥–∞–ª–µ–Ω–æ') }

  /* DnD */
  function addDragHandlers(el, list, eq, rerender){ let dragIndex; el.addEventListener('dragstart', e=>{ el.classList.add('dragging'); dragIndex = [...el.parentNode.children].indexOf(el) }); el.addEventListener('dragend', e=>{ el.classList.remove('dragging') }); el.addEventListener('dragover', e=>{ e.preventDefault(); const over = e.currentTarget; const overIndex = [...over.parentNode.children].indexOf(over); const dragging = over.parentNode.querySelector('.dragging'); if(!dragging || dragging===over) return; if(overIndex>dragIndex) over.after(dragging); else over.before(dragging) }); el.addEventListener('drop', e=>{ const ids = [...el.parentNode.children].map(n=>+n.dataset.id).filter(Boolean); list.sort((a,b)=> ids.indexOf(a.id) - ids.indexOf(b.id)); rerender() }) }

  /* Sparkline */
  function renderSpark(){ const svg = document.getElementById('spark'); const w=200, h=40; const max=Math.max(...state.progress); const pts = state.progress.map((v,i)=>[i*(w/(state.progress.length-1)), h - (v/max)*(h-6) - 3]); const d = pts.map((p,i)=> (i?'L':'M')+p[0]+','+p[1]).join(' '); const color = getComputedStyle(document.documentElement).getPropertyValue('--ga-green-2').trim() || '#3FB950'; svg.innerHTML = `<path d="${d}" fill="none" stroke="${color}" stroke-width="2"/><circle cx="${pts[pts.length-1][0]}" cy="${pts[pts.length-1][1]}" r="3" fill="${color}"/>` }

  /* HADI */
  function renderHADI(){ const cols = document.querySelectorAll('.column'); cols.forEach(c=> c.querySelectorAll('.hadi-card').forEach(n=>n.remove())); state.hadi.forEach(card=>{ const el = document.createElement('div'); el.className='hadi-card'; el.draggable=true; el.dataset.id=card.id; el.innerHTML = `<div style="font-weight:600; margin-bottom:4px">${card.title}</div><div class="meta">H: ${card.H}</div><div class="meta">A: ${card.A}</div><div class="meta">D: ${card.D}</div><div class="meta">–î–µ–¥–ª–∞–π–Ω: ${card.deadline}</div>`; el.addEventListener('dragstart',()=> el.classList.add('dragging')); el.addEventListener('dragend',()=> el.classList.remove('dragging')); document.querySelector(`.column[data-col="${card.col}"]`).appendChild(el) }); document.querySelectorAll('.column').forEach(col=>{ col.addEventListener('dragover', e=>{ e.preventDefault(); const dragging = document.querySelector('.hadi-card.dragging'); if(!dragging) return; col.appendChild(dragging) }); col.addEventListener('drop', e=>{ const dragging = col.querySelector('.hadi-card.dragging'); if(!dragging) return; const id = dragging.dataset.id; const card = state.hadi.find(x=>x.id===id); card.col = col.dataset.col; toast(`–°—Ç–∞—Ç—É—Å: ${card.col}`) }) }) }

  /* Agenda */
  function renderAgenda(){ const hours = document.getElementById('hours'); const slots = document.getElementById('slots'); hours.innerHTML = ''; slots.innerHTML=''; for(let h=9; h<=18; h++){ const hour = document.createElement('div'); hour.className='hour'; hour.textContent = (h<10?'0':'')+h+':00'; hours.appendChild(hour); const slot = document.createElement('div'); slot.className='slot'; slot.dataset.h=h; slots.appendChild(slot) } addEvent(10, 1, '–ò–Ω—Ç–µ—Ä–≤—å—é #1'); addEvent(11, 1, '–ò–Ω—Ç–µ—Ä–≤—å—é #2'); addEvent(15, 2, '–õ–µ–Ω–¥–∏–Ω–≥ ‚Äî –ø—Ä–∞–≤–∫–∏') }
  function addEvent(startHour, duration, title){ const slots = document.getElementById('slots'); const ev = document.createElement('div'); ev.className='event'; ev.style.top = ( (startHour-9)*48 + 6) + 'px'; ev.style.height = (duration*48 - 12) + 'px'; ev.textContent = title; slots.appendChild(ev) }

  /* Bars */
  function renderBars(id, values){ const el = document.getElementById(id); el.innerHTML=''; values.forEach(v=>{ const b=document.createElement('div'); b.className='bar'; b.style.height=(10+v*8)+'px'; el.appendChild(b) }) }

  /* Modal control */
  const modal = document.getElementById('modal')
  function openQuickAdd(type){ currentAddType = type; document.getElementById('modalTitle').textContent = {task:'–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞', hypothesis:'–ù–æ–≤–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞', note:'–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞'}[type]; document.getElementById('modalInput').value=''; showModal() }
  function showModal(){ modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; setTimeout(()=>document.getElementById('modalInput').focus(), 0) }
  function closeModal(){ modal.setAttribute('aria-hidden','true'); document.body.style.overflow='' }
  modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal() })
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal() })

  /* Modal add */
  let currentAddType = 'task'
  function confirmAdd(){ const val = document.getElementById('modalInput').value.trim(); if(!val) return closeModal(); if(currentAddType==='task'){ state.tasks.push({ id:Date.now(), title:val, due:'‚Äî', ready:'–∫—Ä–∏—Ç–µ—Ä–∏–π', status:'todo' }); renderTasks() } else if(currentAddType==='hypothesis'){ state.hadi.push({ id:'h'+Date.now(), col:'Planned', title:val, H:'...', A:'...', D:'...', deadline:'‚Äî' }); renderHADI() } closeModal(); toast('–î–æ–±–∞–≤–ª–µ–Ω–æ') }

  /* FAB */
  const fab = document.getElementById('fab'); const menu = document.getElementById('fabMenu')
  function toggleFab(show){ if(show===undefined) show = menu.hidden; menu.hidden = !show }
  fab.addEventListener('click', ()=> toggleFab())
  document.addEventListener('click', (e)=>{ if(!menu.hidden && !menu.contains(e.target) && e.target!==fab) menu.hidden = true })

  /* AI mock */
  function aiNextStep(){ toast('AI –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (–¥–µ–º–æ)') }

  /* Toast */
  function toast(msg){ const t = document.createElement('div'); t.textContent = msg; t.style.cssText = 'position:fixed;bottom:86px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:var(--shadow-sm);opacity:.98;z-index:99'; document.body.appendChild(t); setTimeout(()=>{t.style.transition='opacity .4s'; t.style.opacity='0'; setTimeout(()=>t.remove(), 400)}, 900) }

  /* Init */
  function init(){
    document.getElementById('focusInput').value = state.focus
    document.getElementById('focusMeta').textContent = `–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ ${state.reminders.daily_focus_time} ‚Ä¢ –Ω–µ–¥. –ø–ª–∞–Ω—ë—Ä–∫–∞: ${state.reminders.weekly_planning_slot}`
    renderTasks(); renderSpark(); renderHADI(); renderAgenda();
    renderBars('bars1',[2,3,4,5,3,4,6]); renderBars('bars2',[1,1,2,2,3,3,4]); renderBars('bars3',[4,3,5,6,5,4,3])
    toggleFab(true); // —Ç–æ–ª—å–∫–æ FAB, –º–æ–¥–∞–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–∫—Ä—ã—Ç
    closeModal();    // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º
  }
  init()
</script>
</body>
</html>
