<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Growth Assistant ¬∑ Candy Minimal (Light)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* === Candy‚Äëminimal design system (—Å–≤–µ—Ç–ª–∞—è ¬´–∫–æ–Ω—Ñ–µ—Ç–∫–∞¬ª) === */
    :root{
      --primary:#0EA5E9;      /* sky */
      --primary-2:#22D3EE;    /* twin for subtle gradients */
      --success:#10B981;      /* emerald */
      --text:#0F172A;         /* slate-900 */
      --sub:#64748B;          /* slate-500 */
      --bg:#F6F8FB;           /* soft app background */
      --surface:#FFFFFF;      /* card */
      --line:#E5E7EB;         /* hairline */
      --chip:#F1F5F9;         /* chip bg */
      --radius-xl:18px; --radius-lg:14px; --radius-md:12px; --radius-sm:10px;
      --shadow-xs:0 1px 2px rgba(15,23,42,.05);
      --shadow-sm:0 6px 18px rgba(15,23,42,.08);
      --shadow-md:0 14px 32px rgba(15,23,42,.10);
      --h1:22px; --h2:17px; --body:16px; --caption:13px; --micro:12px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:var(--bg); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale}
    img,svg{max-width:100%; display:block}
    button,input,select,textarea{font:inherit}

    /* Layout */
    .app{min-height:100%; display:flex; flex-direction:column}
    header{position:sticky; top:0; z-index:20; background:rgba(255,255,255,.9); backdrop-filter:saturate(140%) blur(10px); border-bottom:1px solid var(--line)}
    .topbar{display:flex; align-items:center; gap:12px; max-width:980px; margin:0 auto; padding:10px 14px}
    .brand{display:flex; align-items:center; gap:10px}
    .logo{width:28px;height:28px;border-radius:9px; background:linear-gradient(135deg,var(--primary),var(--primary-2)); display:grid;place-items:center; color:#fff; font-weight:700}
    .title{font-size:18px; font-weight:700}
    .pill{margin-left:auto; font-size:12px; padding:6px 10px; border-radius:999px; background:#E0F2FE; color:#0369A1; border:1px solid #BAE6FD}
    main{flex:1; max-width:980px; width:100%; margin:0 auto; padding:14px 14px 140px}

    /* Cards */
    .card{background:var(--surface); border:1px solid var(--line); border-radius:var(--radius-xl); padding:14px; box-shadow:var(--shadow-xs)}
    .card + .card{margin-top:12px}

    h1{font-size:var(--h1); margin:6px 0 10px}
    h2{font-size:var(--h2); margin:0 0 8px 0}
    .sub{color:var(--sub); font-size:var(--caption)}

    /* === Composer (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è) === */
    .composer{position:relative}
    .composer .collapsed{display:flex; align-items:center; gap:10px; background:#fff; border:1px solid var(--line); border-radius:999px; padding:10px 12px; cursor:text; box-shadow:var(--shadow-xs)}
    .avatar{width:28px;height:28px;border-radius:8px; background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:#fff; display:grid; place-items:center; font-weight:700}
    .placeholder{color:#94A3B8}
    .composer.expanded .collapsed{display:none}
    .composer .panel{display:none; background:#fff; border:1px solid var(--line); border-radius:16px; padding:12px; box-shadow:var(--shadow-sm)}
    .composer.expanded .panel{display:block}
    .row{display:flex; gap:8px; align-items:center}
    .input{height:44px; padding:0 12px; border-radius:12px; border:1px solid var(--line); background:#fff; color:#111827; width:100%}
    .chip{font-size:12px; padding:6px 8px; border-radius:999px; background:var(--chip); border:1px solid var(--line); color:#334155; cursor:pointer; user-select:none}
    .chip.active{background:linear-gradient(135deg,var(--primary),var(--primary-2)); color:#fff; border-color:transparent}
    .btn{height:44px; padding:0 14px; border-radius:12px; border:1px solid transparent; background:var(--primary); color:#fff; font-weight:600; cursor:pointer}
    .btn.ghost{background:#F8FAFC; color:#0F172A; border-color:var(--line)}

    /* Tasks */
    .list{display:flex; flex-direction:column; gap:8px}
    .item{display:flex; align-items:center; gap:10px; padding:10px; background:#fff; border:1px solid var(--line); border-radius:12px}
    .item .check{appearance:none; width:20px; height:20px; border-radius:6px; border:1px solid var(--line); background:#fff}
    .item .check:checked{background:linear-gradient(135deg,var(--success),#059669); border-color:transparent}
    .item .body{flex:1; min-width:0}
    .item .title{font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .item .hint{color:var(--sub); font-size:12px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .due{font-size:12px; color:#0F766E; background:#ECFDF5; border:1px solid #A7F3D0; padding:4px 8px; border-radius:999px; white-space:nowrap}

    /* Route / HADI */
    .badge{font-size:12px; padding:4px 8px; border-radius:999px; background:#EFF6FF; color:#1D4ED8; border:1px solid #DBEAFE}
    .board{display:grid; grid-template-columns:repeat(4, minmax(220px,1fr)); gap:12px; align-items:start}
    .column{background:#fff; border:1px solid var(--line); border-radius:14px; padding:10px; min-height:220px}
    .hcard{background:#fff; border:1px solid var(--line); border-radius:12px; padding:10px; margin:8px 4px}
    .meta{font-size:12px; color:#6B7280}

    /* Agenda */
    .agenda{display:grid; grid-template-columns:80px 1fr; border:1px solid var(--line); border-radius:16px; overflow:hidden; background:#fff}
    .hours{background:#F8FAFC; border-right:1px solid var(--line)}
    .hour{height:48px; padding:6px 8px; font-size:12px; color:#6B7280; border-bottom:1px dashed #E5E7EB}
    .slots{position:relative}
    .slot{height:48px; border-bottom:1px dashed #E5E7EB; position:relative}
    .event{position:absolute; left:8px; right:8px; background:#D1FAE5; color:#065F46; border:1px solid #A7F3D0; border-radius:12px; padding:8px; font-size:12px; box-shadow:var(--shadow-xs)}

    /* KPIs */
    .kpi-grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px}
    .kpi{background:#fff; border:1px solid var(--line); border-radius:16px; padding:12px}
    .kpi .value{font-size:22px; font-weight:700}
    .kpi .delta.up{color:#059669}
    .kpi .delta.down{color:#DC2626}

    /* Bottom nav */
    nav{position:fixed; bottom:0; left:0; right:0; z-index:10; background:rgba(255,255,255,.96); border-top:1px solid var(--line); padding:6px env(safe-area-inset-left) calc(6px + env(safe-area-inset-bottom)) env(safe-area-inset-right); backdrop-filter:saturate(140%) blur(8px)}
    .tabs{max-width:980px; margin:0 auto; display:grid; grid-template-columns:repeat(5,1fr); gap:6px}
    .tab{display:flex; flex-direction:column; align-items:center; justify-content:center; height:56px; gap:4px; border-radius:12px; color:#64748B}
    .tab.active{color:#0F172A; background:#F1F5F9; font-weight:600}

    /* Safe overflow */
    .card,.item,.hcard{overflow:hidden}
    .clamp-2{display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden}

    @media (max-width:420px){ .board{grid-template-columns:1fr 1fr} }
    @media (min-width:768px){ main{padding-bottom:160px} }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="topbar">
      <div class="brand"><div class="logo">GA</div><div class="title">Growth Assistant</div></div>
      <div class="pill">Light ¬∑ –º–∏–Ω–∏–º–∞–ª</div>
    </div>
  </header>

  <main>
    <!-- TODAY -->
    <section id="screen-today" class="screen">
      <h1>–°–µ–≥–æ–¥–Ω—è</h1>

      <!-- Focus -->
      <div class="card">
        <h2>–§–æ–∫—É—Å –¥–Ω—è</h2>
        <div class="row" style="gap:8px">
          <input id="focusInput" class="input" placeholder="–°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ —Å–µ–≥–æ–¥–Ω—è‚Ä¶" />
          <button class="btn" onclick="saveFocus()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
        <div class="sub" style="margin-top:6px">–ö–æ—Ä–æ—Ç–∫–æ –∏ –∏–∑–º–µ—Ä–∏–º–æ. –ü—Ä–∏–º–µ—Ä: ¬´5 –∏–Ω—Ç–µ—Ä–≤—å—é + —á–µ—Ä–Ω–æ–≤–∏–∫ –ª–µ–Ω–¥–∏–Ω–≥–∞¬ª</div>
      </div>

      <!-- NEW Composer (collapsed ‚Üí expanded) -->
      <div class="card composer" id="composer">
        <div class="collapsed" onclick="expandComposer()">
          <div class="avatar">Ôºã</div>
          <div class="placeholder">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É‚Ä¶</div>
          <span class="sub" style="margin-left:auto">Enter ‚Äî –¥–æ–±–∞–≤–∏—Ç—å</span>
        </div>
        <div class="panel">
          <div class="row" style="align-items:flex-start">
            <input id="newTitle" class="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" onkeydown="if(event.key==='Enter'){commitTask()}"/>
            <button class="btn" onclick="commitTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
          </div>
          <div class="row" style="flex-wrap:wrap; margin-top:8px">
            <span class="sub">–°–ø–∏—Å–æ–∫:</span>
            <button class="chip active" data-list="today" onclick="pickList(this)">–°–µ–≥–æ–¥–Ω—è</button>
            <button class="chip" data-list="week" onclick="pickList(this)">–ù–∞ –Ω–µ–¥–µ–ª–µ</button>
            <button class="chip" data-list="backlog" onclick="pickList(this)">–ë—ç–∫–ª–æ–≥</button>
            <span class="space"></span>
            <input id="newDue" class="input" placeholder="–î–µ–¥–ª–∞–π–Ω (–Ω–∞–ø—Ä. 26.10)" style="max-width:160px">
            <button class="btn ghost" onclick="collapseComposer()">–û—Ç–º–µ–Ω–∞</button>
          </div>
          <div class="sub" style="margin-top:6px">–ü–æ–¥—Å–∫–∞–∑–∫–∏: Enter ‚Äî –¥–æ–±–∞–≤–∏—Ç—å ¬∑ /—Å–µ–≥–æ–¥–Ω—è /–Ω–µ–¥–µ–ª—è /–±—ç–∫–ª–æ–≥ ‚Äî –≤—ã–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫ ¬∑ 26.10 ‚Äî –¥–µ–¥–ª–∞–π–Ω</div>
        </div>
      </div>

      <!-- Top‚Äë3 Tasks -->
      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:center">
          <h2>–¢–æ–ø‚Äë3 –∑–∞–¥–∞—á–∏</h2>
          <span class="sub">–ø–µ—Ä–µ—Ç–∞—â–∏, —á—Ç–æ–±—ã —É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å</span>
        </div>
        <div id="taskList" class="list"></div>
      </div>

      <!-- Weekly Progress -->
      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:6px">
          <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–¥–µ–ª–∏</strong>
          <span class="chip" id="progressChip">3/7 –¥–Ω–µ–π</span>
        </div>
        <svg viewBox="0 0 200 40" class="sparkline" id="spark"></svg>
      </div>
    </section>

    <!-- ROUTE -->
    <section id="screen-route" class="screen" hidden>
      <h1>–ú–∞—Ä—à—Ä—É—Ç</h1>
      <div class="card"><div class="row" style="flex-wrap:wrap"><span class="badge">–ò–¥–µ—è</span><span class="badge">–†–µ–º–µ—Å–ª–æ ‚Üí –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å</span><span class="badge">–†–æ—Å—Ç</span><span class="sub" style="margin-left:auto">–°—Ç–∞—Ç—É—Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è</span></div></div>
      <div class="card"><h2>–ë–ª–∏–∂–∞–π—à–∏–µ —à–∞–≥–∏</h2><div class="list" id="steps"></div></div>
    </section>

    <!-- HADI -->
    <section id="screen-hadi" class="screen" hidden>
      <h1>HADI</h1>
      <div class="board" id="hadiBoard">
        <div class="column" data-col="Planned"><h3>Planned</h3></div>
        <div class="column" data-col="Running"><h3>Running</h3></div>
        <div class="column" data-col="Review"><h3>Review</h3></div>
        <div class="column" data-col="Done"><h3>Done</h3></div>
      </div>
    </section>

    <!-- CALENDAR -->
    <section id="screen-calendar" class="screen" hidden>
      <h1>–ö–∞–ª–µ–Ω–¥–∞—Ä—å (–Ω–µ–¥–µ–ª—è)</h1>
      <div class="agenda"><div class="hours" id="hours"></div><div class="slots" id="slots"></div></div>
    </section>

    <!-- METRICS -->
    <section id="screen-metrics" class="screen" hidden>
      <h1>–ú–µ—Ç—Ä–∏–∫–∏</h1>
      <div class="kpi-grid">
        <div class="kpi"><div class="sub">–õ–∏–¥—ã / –Ω–µ–¥–µ–ª—è</div><div class="value">32 <span class="delta up">‚ñ≤ +8</span></div></div>
        <div class="kpi"><div class="sub">–ö–æ–Ω–≤–µ—Ä—Å–∏—è, %</div><div class="value">1.6% <span class="delta up">‚ñ≤ +0.4</span></div></div>
        <div class="kpi"><div class="sub">–í—ã—Ä—É—á–∫–∞ / –Ω–µ–¥.</div><div class="value">‚ÇΩ 128‚ÄØ000 <span class="delta down">‚ñº ‚àí12‚ÄØ000</span></div></div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="screen-settings" class="screen" hidden>
      <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
      <div class="card" style="display:grid; gap:12px">
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <span class="badge">–¢–∞–π–º–∑–æ–Ω–∞: Europe/Moscow</span>
          <span class="badge">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –≤–∫–ª</span>
          <span class="badge">–¢–∞—Ä–∏—Ñ: –ë–∞–∑–æ–≤—ã–π</span>
        </div>
        <div class="sub">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Google Calendar / iCal) –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –≤ –ø—Ä–æ–¥–µ</div>
      </div>
    </section>
  </main>

  <nav>
    <div class="tabs">
      <button class="tab active" data-target="today">üè†<span class="micro">–°–µ–≥–æ–¥–Ω—è</span></button>
      <button class="tab" data-target="route">üß≠<span class="micro">–ú–∞—Ä—à—Ä—É—Ç</span></button>
      <button class="tab" data-target="hadi">üß™<span class="micro">HADI</span></button>
      <button class="tab" data-target="calendar">üóìÔ∏è<span class="micro">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
      <button class="tab" data-target="metrics">üìä<span class="micro">–ú–µ—Ç—Ä–∏–∫–∏</span></button>
      <button class="tab" data-target="settings">‚öôÔ∏è<span class="micro">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
    </div>
  </nav>
</div>

<script>
  /* ===== State ===== */
  const state = {
    focus: '5 –∏–Ω—Ç–µ—Ä–≤—å—é –∫–ª–∏–µ–Ω—Ç–æ–≤ + –ª–µ–Ω–¥–∏–Ω–≥',
    lists:{ today:[], week:[], backlog:[] },
    progress:[2,3,4,2,5,3,4],
    steps:[
      {id:'s1',title:'–°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ—Ñ–µ—Ä + 5 –∏–Ω—Ç–µ—Ä–≤—å—é',hint:'–∫—Ä–∏—Ç–µ—Ä–∏–π: –∑–∞–ø–∏—Å–∏/–∏–Ω—Å–∞–π—Ç—ã',due:'26.10'},
      {id:'s2',title:'–õ–µ–Ω–¥–∏–Ω–≥ –æ—Ñ—Ñ–µ—Ä–∞',hint:'–≥–æ—Ç–æ–≤–æ: –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω URL',due:'23.10'},
      {id:'s3',title:'–ó–∞–ø—É—Å–∫ –∫–∞–Ω–∞–ª–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Ññ1',hint:'–±—é–¥–∂–µ—Ç ‚â• 3‚ÄØ000 ‚ÇΩ',due:'24.10'},
    ],
    hadi:[
      { id:'h1', col:'Planned', title:'–°–µ–≥–º–µ–Ω—Ç X ‚Üí –ø—Ä–æ–±–Ω—ã–µ 8%', H:'–æ—Ñ—Ñ–µ—Ä Y', A:'–ª–µ–Ω–¥–∏–Ω–≥ + –∫–∞–Ω–∞–ª', D:'leads:30, trial:8%', deadline:'27.10' },
      { id:'h2', col:'Running', title:'–í–∏–∑–∏—Ç‚Üí–ª–∏–¥ 1.2%‚Üí1.8%', H:'–∑–∞–≥–æ–ª–æ–≤–æ–∫', A:'A/B', D:'v2l:+0.6', deadline:'25.10' },
      { id:'h3', col:'Review', title:'–†–µ—Ñ–µ—Ä–∞–ª‚Äë–º–∏–Ω–∏', H:'10% –Ω–æ–≤—ã—Ö', A:'–ø–æ—Å—Ç + –∫–æ–¥', D:'ref:10%', deadline:'22.10' },
      { id:'h4', col:'Done', title:'–°–Ω–∏–∑–∏—Ç—å TTV', H:'–±—ã—Å—Ç—Ä–µ–µ 20%', A:'–æ–Ω–±–æ—Ä–¥–∏–Ω–≥', D:'ttv:-20%', deadline:'15.10' },
    ]
  }
  // —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
  state.lists.today = [
    {id:1,title:'–ü—Ä–æ–≤–µ—Å—Ç–∏ 5 –∏–Ω—Ç–µ—Ä–≤—å—é –ø–æ JTBD',hint:'–≥–æ—Ç–æ–≤–æ, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏/–∏–Ω—Å–∞–π—Ç—ã',due:'26.10',done:false},
    {id:2,title:'–õ–µ–Ω–¥–∏–Ω–≥ –æ—Ñ—Ñ–µ—Ä–∞ v1',hint:'–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω URL',due:'23.10',done:false},
    {id:3,title:'–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–Ω–∞–ª —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Ññ1',hint:'–≤–∫–ª. —Ä–µ–∫–ª–∞–º–∞ ‚â•3‚ÄØ000 ‚ÇΩ',due:'24.10',done:false},
  ]

  /* ===== Tabs ===== */
  document.querySelectorAll('.tab').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'))
      btn.classList.add('active')
      const target = btn.dataset.target
      document.querySelectorAll('.screen').forEach(s=> s.hidden = true)
      document.getElementById('screen-'+target).hidden = false
      window.scrollTo({ top:0, behavior:'smooth' })
    })
  })

  /* ===== Focus ===== */
  function saveFocus(){ const v=document.getElementById('focusInput').value.trim(); state.focus = v || state.focus; document.getElementById('focusInput').value = state.focus; toast('–§–æ–∫—É—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω') }

  /* ===== Composer logic ===== */
  let pickedList='today'
  function expandComposer(){ const c=document.getElementById('composer'); c.classList.add('expanded'); setTimeout(()=>document.getElementById('newTitle').focus(), 0) }
  function collapseComposer(){ const c=document.getElementById('composer'); c.classList.remove('expanded'); document.getElementById('newTitle').value=''; document.getElementById('newDue').value='' }
  function pickList(el){ document.querySelectorAll('#composer .chip').forEach(x=>x.classList.remove('active')); el.classList.add('active'); pickedList=el.dataset.list }
  function commitTask(){
    const title = document.getElementById('newTitle').value.trim(); if(!title) return collapseComposer()
    const due = (document.getElementById('newDue').value.trim() || '‚Äî')
    state.lists[pickedList].unshift({id:Date.now(), title, hint:'–∫—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏', due, done:false})
    renderTop3(); collapseComposer(); toast('–î–æ–±–∞–≤–ª–µ–Ω–æ')
  }

  /* ===== Top‚Äë3 render ===== */
  function renderTop3(){
    const arr = state.lists.today.concat(state.lists.week).concat(state.lists.backlog)
    const top = arr.slice(0,3)
    const holder = document.getElementById('taskList'); holder.innerHTML=''
    if(!top.length){ holder.innerHTML = '<div class="sub">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É —á–µ—Ä–µ–∑ –±–ª–æ–∫ –≤—ã—à–µ</div>'; return }
    top.forEach(t=>{
      const el = document.createElement('div'); el.className='item'; el.draggable=true; el.dataset.id=t.id
      el.innerHTML = `<input type="checkbox" class="check" ${t.done?'checked':''} onchange="toggleDone(${t.id}, this.checked)"><div class="body"><div class="title">${esc(t.title)}</div><div class="hint">${esc(t.hint)}</div></div><span class="due">–¥–æ ${esc(t.due)}</span>`
      addDragHandlers(el, top, (a,b)=>a.id===b.id, renderTop3)
      holder.appendChild(el)
    })
  }
  function toggleDone(id, checked){ ['today','week','backlog'].forEach(k=>{ const t=state.lists[k].find(x=>x.id===id); if(t) t.done=!!checked }); toast(checked?'–ì–æ—Ç–æ–≤–æ üéâ':'–í–µ—Ä–Ω—É–ª–∏ –≤ —Ä–∞–±–æ—Ç—É') }

  /* ===== Steps (Route) ===== */
  function renderSteps(){ const box=document.getElementById('steps'); box.innerHTML=''; state.steps.forEach(s=>{ const el=document.createElement('div'); el.className='item'; el.innerHTML=`<div class="body"><div class="title">${esc(s.title)}</div><div class="hint">${esc(s.hint)}</div></div><span class="due">–¥–æ ${esc(s.due)}</span>`; box.appendChild(el) }) }

  /* ===== HADI board ===== */
  function renderHADI(){ const cols=document.querySelectorAll('.column'); cols.forEach(c=>c.querySelectorAll('.hcard').forEach(n=>n.remove())); state.hadi.forEach(card=>{ const el=document.createElement('div'); el.className='hcard'; el.draggable=true; el.dataset.id=card.id; el.innerHTML=`<div style="font-weight:600; margin-bottom:4px">${esc(card.title)}</div><div class="meta">H: ${esc(card.H)}</div><div class="meta">A: ${esc(card.A)}</div><div class="meta">D: ${esc(card.D)}</div><div class="meta">–î–µ–¥–ª–∞–π–Ω: ${esc(card.deadline)}</div>`; el.addEventListener('dragstart',()=> el.classList.add('dragging')); el.addEventListener('dragend',()=> el.classList.remove('dragging')); document.querySelector(`.column[data-col="${card.col}"]`).appendChild(el) }); document.querySelectorAll('.column').forEach(col=>{ col.addEventListener('dragover', e=>{ e.preventDefault(); const dragging=document.querySelector('.hcard.dragging'); if(!dragging) return; col.appendChild(dragging) }); col.addEventListener('drop', e=>{ const dragging = col.querySelector('.hcard.dragging'); if(!dragging) return; const id = dragging.dataset.id; const card = state.hadi.find(x=>x.id===id); card.col = col.dataset.col; toast(`–°—Ç–∞—Ç—É—Å: ${card.col}`) }) }) }

  /* ===== Agenda ===== */
  function renderAgenda(){ const hours=document.getElementById('hours'); const slots=document.getElementById('slots'); hours.innerHTML=''; slots.innerHTML=''; for(let h=9; h<=18; h++){ const hour=document.createElement('div'); hour.className='hour'; hour.textContent=(h<10?'0':'')+h+':00'; hours.appendChild(hour); const slot=document.createElement('div'); slot.className='slot'; slots.appendChild(slot) } addEvent(10,1,'–ò–Ω—Ç–µ—Ä–≤—å—é #1'); addEvent(11,1,'–ò–Ω—Ç–µ—Ä–≤—å—é #2'); addEvent(15,2,'–õ–µ–Ω–¥–∏–Ω–≥ ‚Äî –ø—Ä–∞–≤–∫–∏') }
  function addEvent(startHour,duration,title){ const slots=document.getElementById('slots'); const ev=document.createElement('div'); ev.className='event'; ev.style.top=((startHour-9)*48+6)+'px'; ev.style.height=(duration*48-12)+'px'; ev.textContent=title; slots.appendChild(ev) }

  /* ===== Sparkline ===== */
  function renderSpark(){ const svg=document.getElementById('spark'); const w=200, h=40; const v=state.progress; const max=Math.max(...v); const pts=v.map((val,i)=>[i*(w/(v.length-1)), h - (val/max)*(h-6) - 3]); const d=pts.map((p,i)=> (i?'L':'M')+p[0]+','+p[1]).join(' '); const color=getComputedStyle(document.documentElement).getPropertyValue('--primary').trim()||'#0EA5E9'; svg.innerHTML=`<path d="${d}" fill="none" stroke="${color}" stroke-width="2"/><circle cx="${pts[pts.length-1][0]}" cy="${pts[pts.length-1][1]}" r="3" fill="${color}"/>` }

  /* ===== DnD helper ===== */
  function addDragHandlers(el, list, eq, rerender){ let dragIndex; el.addEventListener('dragstart', e=>{ el.classList.add('dragging'); dragIndex = [...el.parentNode.children].indexOf(el) }); el.addEventListener('dragend', e=>{ el.classList.remove('dragging') }); el.addEventListener('dragover', e=>{ e.preventDefault(); const over = e.currentTarget; const overIndex = [...over.parentNode.children].indexOf(over); const dragging = over.parentNode.querySelector('.dragging'); if(!dragging || dragging===over) return; if(overIndex>dragIndex) over.after(dragging); else over.before(dragging) }); el.addEventListener('drop', e=>{ const ids = [...el.parentNode.children].map(n=>+n.dataset.id).filter(Boolean); list.sort((a,b)=> ids.indexOf(a.id) - ids.indexOf(b.id)); rerender() }) }

  /* ===== Utils ===== */
  function toast(msg){ const t=document.createElement('div'); t.textContent=msg; t.style.cssText='position:fixed;bottom:84px;left:50%;transform:translateX(-50%);background:#0F172A;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:var(--shadow-sm);opacity:.98;z-index:99'; document.body.appendChild(t); setTimeout(()=>{t.style.transition='opacity .4s'; t.style.opacity='0'; setTimeout(()=>t.remove(), 400)}, 900) }
  function esc(s){ return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])) }

  /* ===== Init ===== */
  function init(){ document.getElementById('focusInput').value = state.focus; renderTop3(); renderSteps(); renderHADI(); renderAgenda(); renderSpark() }
  init()
</script>
</body>
</html>
