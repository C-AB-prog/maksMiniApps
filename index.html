<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>Growth Assistant ¬∑ Ultra‚ÄëMinimal Mobile</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* === Ultra‚Äëminimal, neutral light, mobile‚Äëfirst === */
    :root{
      --accent:#3B82F6;         /* single brand accent */
      --bg:#FAFAFB;             /* app bg */
      --surface:#FFFFFF;        /* card */
      --line:#EDEEF2;           /* hairline */
      --text:#0F172A;           /* primary */
      --muted:#6B7280;          /* secondary */
      --ok:#16A34A; --warn:#EA580C; --err:#DC2626;
      --r-lg:14px; --r-md:12px; --r-sm:10px;
      --sh-xs:0 1px 2px rgba(15,23,42,.04);
      --h1:clamp(18px,4vw,22px); --h2:clamp(15px,3.4vw,17px); --body:15px; --cap:12px;
      --sp-1:6px; --sp-2:10px; --sp-3:12px; --sp-4:16px; --sp-5:20px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; font-size:var(--body); color:var(--text); background:var(--bg); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; -webkit-tap-highlight-color:transparent}
    img,svg{max-width:100%; display:block}
    button,input,select,textarea{font:inherit}

    /* Layout */
    .app{min-height:100%; display:flex; flex-direction:column}
    header{position:sticky; top:0; z-index:20; background:#fff; border-bottom:1px solid var(--line)}
    .topbar{display:flex; align-items:center; gap:var(--sp-2); padding:var(--sp-2) var(--sp-3)}
    .brand{display:flex; align-items:center; gap:var(--sp-2)}
    .dot{width:18px;height:18px;border-radius:6px; background:var(--accent)}
    .title{font-weight:700}

    .seg{display:flex; gap:6px; overflow:auto; padding:0 var(--sp-3) var(--sp-2)}
    .seg button{height:34px; padding:0 12px; border-radius:999px; border:1px solid var(--line); background:#fff; color:#111827}
    .seg button.active{border-color:var(--accent); color:#0B4DD9}

    main{flex:1; padding:0 var(--sp-3) calc(180px + env(safe-area-inset-bottom))}

    /* Cards */
    .card{background:var(--surface); border:1px solid var(--line); border-radius:var(--r-lg); padding:var(--sp-3); box-shadow:var(--sh-xs)}
    .card + .card{margin-top:var(--sp-3)}

    h1{font-size:var(--h1); margin:var(--sp-2) 0 var(--sp-2)}
    h2{font-size:var(--h2); margin:0 0 var(--sp-2) 0}
    .sub{color:var(--muted); font-size:var(--cap)}

    /* Inputs & buttons */
    .row{display:flex; gap:var(--sp-2); align-items:center}
    .input{height:44px; padding:0 12px; width:100%; border-radius:12px; border:1px solid var(--line); background:#fff}
    .btn{height:44px; padding:0 14px; border-radius:12px; border:0; background:linear-gradient(135deg,var(--accent),#60A5FA); color:#fff; font-weight:700; box-shadow:0 6px 14px rgba(59,130,246,.18)}
    .btn.ghost{background:#fff; color:#111827; border-color:var(--line)}

    /* Quick add (single‚Äëstep) */
    .quick{display:flex; gap:8px}
    .chip{height:34px; padding:0 10px; border-radius:999px; border:1px solid var(--line); background:#fff; font-size:12px; color:#111827}
    .chip.active{border-color:transparent; color:#0B4DD9; background:linear-gradient(135deg,#EEF2FF,#E0EAFF)}

    /* List */
    .list{display:flex; flex-direction:column; gap:8px}
    .item{display:flex; align-items:center; gap:8px; padding:10px; background:#fff; border:1px solid var(--line); border-radius:12px; min-width:0}
    .check{appearance:none; width:20px; height:20px; border-radius:6px; border:1px solid var(--line); background:#fff}
    .check:checked{background:var(--accent); border-color:var(--accent)}
    .body{flex:1; min-width:0}
    .title{font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .hint{color:var(--muted); font-size:12px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .tag{font-size:11px; color:#0F766E; background:#ECFDF5; border:1px solid #A7F3D0; padding:4px 6px; border-radius:999px; white-space:nowrap}
    .more{border:none; background:transparent; font-size:18px; color:#9CA3AF}

    /* Context menu */
    .ctx{position:fixed; z-index:40; background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:var(--sh-xs); padding:6px; min-width:160px}
    .act{display:block; width:100%; text-align:left; border:none; background:#fff; padding:8px 10px; border-radius:8px; font-size:14px}
    .act:hover{background:#F8FAFC}

    /* Secondary screens */
    .kpi-grid{display:grid; grid-template-columns:repeat(2, minmax(140px,1fr)); gap:10px}
    .kpi{background:#fff; border:1px solid var(--line); border-radius:12px; padding:10px}
    .kpi .value{font-weight:700}

    .board{display:grid; grid-template-columns:repeat(2, minmax(160px,1fr)); gap:10px}
    .column{background:#fff; border:1px solid var(--line); border-radius:12px; padding:10px; min-height:180px}
    .hcard{background:#fff; border:1px solid var(--line); border-radius:10px; padding:10px; margin:6px 2px}

    .agenda{display:grid; grid-template-columns:60px 1fr; border:1px solid var(--line); border-radius:12px; overflow:hidden; background:#fff}
    .hour{height:40px; padding:6px 6px; font-size:12px; color:#6B7280; border-bottom:1px dashed #E5E7EB}
    .slot{height:40px; border-bottom:1px dashed #E5E7EB; position:relative}
    .event{position:absolute; left:6px; right:6px; background:#E3F2FD; color:#0B4DD9; border:1px solid #BFDBFE; border-radius:10px; padding:6px; font-size:12px}

    /* Bottom dock (floating, modern, tap-safe) */
    .dock{position:fixed; left:50%; bottom:12px; transform:translateX(-50%); z-index:50; width:min(520px,92%); padding-bottom:env(safe-area-inset-bottom); pointer-events:none}
    .dock-inner{display:grid; grid-template-columns:repeat(6,1fr); gap:4px; background:rgba(255,255,255,.9); backdrop-filter:saturate(140%) blur(10px); border:1px solid var(--line); border-radius:16px; padding:8px; box-shadow:0 10px 28px rgba(15,23,42,.12); pointer-events:auto}
    .dock-item{height:52px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:3px; border-radius:10px; color:#667085; font-size:12px; border:none; background:transparent; cursor:pointer}
    .dock-item.active{background:#F3F4F6; color:#0F172A; font-weight:600}
    .dock svg{width:20px; height:20px}
    .fab{display:none}
    @media (max-width: 430px){ .dock-item span{display:none} }

    @media (min-width:720px){ .kpi-grid{grid-template-columns:repeat(3, minmax(220px,1fr))} .board{grid-template-columns:repeat(4, minmax(220px,1fr))} .agenda{grid-template-columns:80px 1fr} .hour,.slot{height:48px} }
  .bubble{max-width:85%; padding:10px 12px; border:1px solid var(--line); border-radius:12px}
    .bubble.me{align-self:flex-end; background:#EEF2FF; border-color:#CBD5E1}
    .bubble.bot{align-self:flex-start; background:#F8FAFC}
  .actions{margin-left:auto; display:flex; align-items:center; gap:10px}
    .icon-btn{display:grid; place-items:center; width:32px; height:32px; border-radius:10px; border:1px solid var(--line); background:#fff; color:#0F172A}
    .mini-chip{font-size:12px; padding:4px 8px; border-radius:999px; background:#EEF2FF; color:#1D4ED8; border:1px solid #CBD5E1}

    /* Chat sheet */
    .sheet{position:fixed; inset:0; z-index:60}
    .sheet[hidden]{display:none}
    .sheet-backdrop{position:absolute; inset:0; background:rgba(15,23,42,.3); backdrop-filter:blur(3px)}
    .sheet-panel{position:absolute; left:0; right:0; bottom:0; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; box-shadow:0 -12px 34px rgba(0,0,0,.18); border:1px solid var(--line)}
    .sheet-head{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--line)}
    .sheet-body{max-height:45vh; overflow:auto; padding:10px; display:flex; flex-direction:column; gap:8px}
    .sheet-input{display:flex; gap:8px; padding:10px; border-top:1px solid var(--line)}

    /* Refined dock */
    .dock-inner{background:rgba(255,255,255,.88); border-radius:18px; border:1px solid #E6E8EE; box-shadow:0 10px 28px rgba(15,23,42,.12)}
    .dock-item{transition:transform .12s ease}
    .dock-item:active{transform:scale(.98)}
    /* Chat sticky bar above dock */
  .chatbar{position:fixed; left:50%; transform:translateX(-50%); bottom:calc(12px + 72px + env(safe-area-inset-bottom)); z-index:55; width:min(520px,92%); pointer-events:none}
  .chatbar .btn-chat{pointer-events:auto; display:block; width:100%; height:52px; border-radius:14px; border:0; font-weight:700; color:#fff; background:linear-gradient(135deg,var(--accent),var(--accent-2)); box-shadow:0 10px 26px rgba(59,130,246,.25)}
  .chatbar .btn-chat:active{transform:scale(.99)}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="topbar">
      <div class="brand"><div class="dot" aria-hidden="true"></div><div class="title">Growth Assistant</div></div>
      <div class="actions">
        <span id="focusChip" class="mini-chip" hidden>–§–æ–∫—É—Å: ‚Äî</span>
      </div>
    </div>
    <div class="seg" role="tablist" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <button class="active" data-target="today" role="tab" aria-selected="true">–°–µ–≥–æ–¥–Ω—è</button>
      <button data-target="plan" role="tab">–ü–ª–∞–Ω</button>
      <button data-target="hadi" role="tab">HADI</button>
      <button data-target="calendar" role="tab">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
      <button data-target="metrics" role="tab">–ú–µ—Ç—Ä–∏–∫–∏</button>
      <button data-target="settings" role="tab">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>
  </header>

  <main>
    <!-- TODAY -->
    <section id="screen-today" class="screen" aria-labelledby="todayTitle">
      <h1 id="todayTitle">–°–µ–≥–æ–¥–Ω—è</h1>

      <div class="card">
        <h2>–§–æ–∫—É—Å –¥–Ω—è</h2>
        <div class="row"><input id="focus" class="input" placeholder="–°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ —Å–µ–≥–æ–¥–Ω—è‚Ä¶"><button class="btn" data-action="saveFocus">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
        <div class="sub" style="margin-top:6px">–ü—Ä–∏–º–µ—Ä: ¬´5 –∏–Ω—Ç–µ—Ä–≤—å—é + —á–µ—Ä–Ω–æ–≤–∏–∫ –ª–µ–Ω–¥–∏–Ω–≥–∞¬ª</div>
      </div>

      <div class="card" aria-label="–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏">
        <h2>–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</h2>
        <div class="row" style="flex-wrap:wrap">
          <input id="add" class="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" style="flex:1 1 100%">
          <button class="btn" data-action="quickAdd">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="row" style="flex-wrap:wrap; margin-top:8px">
          <span class="sub">–°–ø–∏—Å–æ–∫:</span>
          <button class="chip active" data-list="today" onclick="pickList(this)">–°–µ–≥–æ–¥–Ω—è</button>
          <button class="chip" data-list="week" onclick="pickList(this)">–ù–µ–¥–µ–ª—è</button>
          <button class="chip" data-list="backlog" onclick="pickList(this)">–ë—ç–∫–ª–æ–≥</button>
          <span class="sub" style="margin-left:auto">–î–µ–¥–ª–∞–π–Ω:</span>
          <input id="dueDate" class="input" type="date" style="max-width:150px">
          <input id="dueTime" class="input" type="time" style="max-width:120px">
        </div>
        <div class="sub" style="margin-top:6px">–ú–æ–∂–Ω–æ –Ω–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å –¥–∞—Ç—É/–≤—Ä–µ–º—è ‚Äî –∑–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–∏—Ç—Å—è –±–µ–∑ –¥–µ–¥–ª–∞–π–Ω–∞</div>
      </div>
        <div class="quick" style="margin-top:8px">
          <button class="chip active" data-list="today" onclick="pickList(this)">–°–µ–≥–æ–¥–Ω—è</button>
          <button class="chip" data-list="week" onclick="pickList(this)">–ù–µ–¥–µ–ª—è</button>
          <button class="chip" data-list="backlog" onclick="pickList(this)">–ë—ç–∫–ª–æ–≥</button>
        </div>
        <div class="sub" style="margin-top:6px">–ü–æ–¥—Å–∫–∞–∑–∫–∏: @26.10 ‚Äî –¥–µ–¥–ª–∞–π–Ω ¬∑ /–Ω–µ–¥–µ–ª—è ‚Äî —Å–ø–∏—Å–æ–∫</div>
      </div>

      <div class="card" role="region" aria-labelledby="tTitle">
        <div class="row" style="justify-content:space-between; align-items:center"><h2 id="tTitle">–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h2><button class="btn ghost" onclick="toggleAll()" id="toggleBtn">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë</button></div>
        <div id="todayList" class="list"></div>
      </div>

      <div class="card" role="region" aria-labelledby="wTitle">
        <h2 id="wTitle">–ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ–¥–µ–ª–∏</h2>
        <svg viewBox="0 0 200 40" id="spark"></svg>
      </div>
    </section>

    <!-- PLAN (–≤—Å–µ —Å–ø–∏—Å–∫–∏) -->
    <section id="screen-plan" class="screen" hidden>
      <h1>–ü–ª–∞–Ω</h1>
      <div class="card"><h2>–°–µ–≥–æ–¥–Ω—è</h2><div id="list-today" class="list"></div></div>
      <div class="card"><h2>–ù–∞ –Ω–µ–¥–µ–ª–µ</h2><div id="list-week" class="list"></div></div>
      <div class="card"><h2>–ë—ç–∫–ª–æ–≥</h2><div id="list-backlog" class="list"></div></div>
    </section>

    <!-- HADI -->
    <section id="screen-hadi" class="screen" hidden>
      <h1>HADI</h1>
      <div class="board">
        <div class="column" data-col="Planned"><strong>Planned</strong></div>
        <div class="column" data-col="Running"><strong>Running</strong></div>
        <div class="column" data-col="Review"><strong>Review</strong></div>
        <div class="column" data-col="Done"><strong>Done</strong></div>
      </div>
    </section>

    <!-- CALENDAR -->
    <section id="screen-calendar" class="screen" hidden>
      <h1>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h1>
      <div class="card" style="margin-bottom:10px">
        <div class="row" style="flex-wrap:wrap">
          <span class="sub">–î–µ–Ω—å:</span>
          <input id="calDate" type="date" class="input" style="max-width:170px">
          <span class="sub" style="margin-left:auto">–ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</span>
          <input id="evtTitle" class="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" style="min-width:140px">
          <input id="evtStart" class="input" type="time" value="10:00" style="max-width:120px">
          <input id="evtDur" class="input" type="number" min="15" step="15" value="60" style="max-width:120px" placeholder="–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –º–∏–Ω">
          <button class="btn" data-action="addEvent">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </div>
      <div class="agenda"><div class="hours" id="hours"></div><div class="slots" id="slots"></div></div>
    </section>

    <!-- METRICS -->
    <section id="screen-metrics" class="screen" hidden>
      <h1>–ú–µ—Ç—Ä–∏–∫–∏</h1>
      <div class="kpi-grid">
        <div class="kpi"><div class="sub">–õ–∏–¥—ã / –Ω–µ–¥–µ–ª—è</div><div class="value">32</div></div>
        <div class="kpi"><div class="sub">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div><div class="value">1.6%</div></div>
        <div class="kpi"><div class="sub">–í—ã—Ä—É—á–∫–∞ / –Ω–µ–¥.</div><div class="value">‚ÇΩ 128‚ÄØ000</div></div>
      </div>
    </section>

    <!-- SETTINGS -->
    <div class="sheet" id="chatSheet" hidden>
      <div class="sheet-backdrop" data-action="closeChat"></div>
      <div class="sheet-panel">
        <div class="sheet-head">
          <strong>–ß–∞—Ç —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</strong>
          <button class="icon-btn" data-action="closeChat" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        </div>
        <div class="sheet-body" id="chatBox"></div>
        <div class="sheet-input">
          <input id="chatInput" class="input" placeholder="–°–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ –ø–ª–∞–Ω, HADI –∏–ª–∏ –∑–∞–¥–∞—á–∏‚Ä¶">
          <button class="btn" data-action="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <section id="screen-settings" class="screen" hidden>
      <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
      <div class="card"><div class="sub">–¢–∞–π–º–∑–æ–Ω–∞: Europe/Helsinki ¬∑ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –≤–∫–ª</div></div>
    </section>
  </main>
  <div class="chatbar">
    <button class="btn-chat" data-action="openChat" aria-label="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç">üí¨ –ß–∞—Ç —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º</button>
  </div>

  <nav class="dock" role="navigation" aria-label="–ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="dock-inner">
      <button class="dock-item active" data-target="today" title="–°–µ–≥–æ–¥–Ω—è">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10l9-7 9 7"/><path d="M9 22V12h6v10"/></svg>
        <span>–°–µ–≥–æ–¥–Ω—è</span>
      </button>
      <button class="dock-item" data-target="plan" title="–ü–ª–∞–Ω">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6l7-2 7 2 4-1v13l-4 1-7-2-7 2-3-1V5z"/></svg>
        <span>–ü–ª–∞–Ω</span>
      </button>
      <button class="dock-item" data-target="hadi" title="HADI">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 22h12"/><path d="M9 22V10l6-6v18"/></svg>
        <span>HADI</span>
      </button>
      <button class="dock-item" data-target="calendar" title="–ö–∞–ª–µ–Ω–¥–∞—Ä—å">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
        <span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
      </button>
      <button class="dock-item" data-target="settings" title="–ü—Ä–æ—Ñ–∏–ª—å">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6"/></svg>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
      </button>
    </div>
  </nav>
</div>

<script>
// ===== ES5-compatible JS (stable for Telegram WebView) =====
(function(){
  // --- State ---
  var lists = { today:[], week:[], backlog:[] };
  var showAll=false, picked='today';
  var events=[], currentDate=todayStr();
  var focusText='';

  // --- LocalStorage helpers ---
  function load(){ try{ var L=localStorage.getItem('ga_lists'); if(L) lists=JSON.parse(L) }catch(e){}
    try{ var E=localStorage.getItem('ga_events'); if(E) events=JSON.parse(E) }catch(e){}
    try{ var F=localStorage.getItem('ga_focus'); if(F) focusText=F }catch(e){} }
  function save(){ try{ localStorage.setItem('ga_lists', JSON.stringify(lists)); localStorage.setItem('ga_events', JSON.stringify(events)); localStorage.setItem('ga_focus', focusText||'') }catch(e){} }

  // --- Seeds (only if –ø—É—Å—Ç–æ) ---
  function seed(){ if(!lists.today.length && !lists.week.length && !lists.backlog.length){
      lists.today=[
        {id:1,title:'–ü—Ä–æ–≤–µ—Å—Ç–∏ 5 –∏–Ω—Ç–µ—Ä–≤—å—é –ø–æ JTBD',hint:'–≥–æ—Ç–æ–≤–æ, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏/–∏–Ω—Å–∞–π—Ç—ã',due:'26.10',done:false},
        {id:2,title:'–õ–µ–Ω–¥–∏–Ω–≥ –æ—Ñ—Ñ–µ—Ä–∞ v1',hint:'–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω URL',due:'23.10',done:false},
        {id:3,title:'–ó–∞–ø—É—Å–∫ –∫–∞–Ω–∞–ª–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Ññ1',hint:'–≤–∫–ª. —Ä–µ–∫–ª–∞–º–∞ ‚â•3‚ÄØ000 ‚ÇΩ',due:'24.10',done:false}
      ];
    }
    if(!events.length){ events.push({id:101,date:currentDate,start:'10:00',dur:60,title:'–ò–Ω—Ç–µ—Ä–≤—å—é #1'}); events.push({id:102,date:currentDate,start:'15:00',dur:90,title:'–õ–µ–Ω–¥–∏–Ω–≥ ‚Äî –ø—Ä–∞–≤–∫–∏'}) }
  }

  // --- Utils ---
  function q(s){return document.querySelector(s)}; function qa(s){return document.querySelectorAll(s)}
  function esc(s){return String(s).replace(/[&<>"']/g,function(m){return {"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]})}
  function toast(msg){ var t=document.createElement('div'); t.textContent=msg; t.style.cssText='position:fixed;bottom:84px;left:50%;transform:translateX(-50%);background:#0F172A;color:#fff;padding:10px 12px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.15);opacity:.98;z-index:99'; document.body.appendChild(t); setTimeout(function(){t.style.transition="opacity .4s"; t.style.opacity='0'; setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t)},400)},900) }
  function todayStr(){ var d=new Date(); return d.toISOString().slice(0,10) }
  function ddmm(dstr){ if(!dstr) return '‚Äî'; var p=dstr.split('-'); return p[2]+'.'+p[1] }
  function truncate(s, n){ if(!s) return ''; return s.length>n? s.slice(0,n-1)+'‚Ä¶': s }

  // --- UI helpers ---
  function updateFocusChip(){ var chip=q('#focusChip'); if(!chip) return; if(focusText){ chip.textContent='–§–æ–∫—É—Å: '+truncate(focusText,26); chip.hidden=false } else { chip.hidden=true } }
  function switchScreen(target, selector){ var i, el; var nodes=qa(selector||'.dock-item'); for(i=0;i<nodes.length;i++){ nodes[i].classList.remove('active') } el=document.querySelector((selector||'.dock-item')+'[data-target="'+target+'"]'); if(el) el.classList.add('active'); var screens=qa('.screen'); for(i=0;i<screens.length;i++){ screens[i].hidden=true } el=q('#screen-'+target); if(el) el.hidden=false; window.scrollTo(0,0) }

  // --- Focus ---
  function saveFocus(){ var input=q('#focus'); var v=(input&&input.value||'').trim(); if(!v){ toast('–í–≤–µ–¥–∏—Ç–µ —Ñ–æ–∫—É—Å –¥–Ω—è'); return } focusText=v; updateFocusChip(); save(); toast('–§–æ–∫—É—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω') }

  // --- Tasks ---
  function pickList(btn){ var chips=qa('.card .chip'); for(var i=0;i<chips.length;i++){ chips[i].classList.remove('active') } btn.classList.add('active'); picked=btn.getAttribute('data-list')||'today' }
  function quickAdd(){ var input=q('#add'); if(!input) return; var title=(input.value||'').trim(); if(!title){ toast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return } var d=q('#dueDate')?q('#dueDate').value:''; var t=q('#dueTime')?q('#dueTime').value:''; var due=d? (ddmm(d)+(t?(' '+t):'')) : '‚Äî'; lists[picked].unshift({id:Date.now(), title:title, hint:'–∫—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏', due:due, done:false}); input.value=''; if(q('#dueDate')) q('#dueDate').value=''; if(q('#dueTime')) q('#dueTime').value=''; save(); renderToday(); renderPlan(); toast('–î–æ–±–∞–≤–ª–µ–Ω–æ') }

  function taskRow(t){ var el=document.createElement('div'); el.className='item'; el.innerHTML='<input type="checkbox" class="check" '+(t.done?'checked':'')+' data-id="'+t.id+'">\
    <div class="body"><div class="title">'+esc(t.title)+'</div><div class="hint">'+esc(t.hint||'')+'</div></div>\
    <span class="tag">'+esc(t.due)+'</span>\
    <button class="more" data-action="menu" data-id="'+t.id+'">‚ãØ</button>'; return el }
  function renderToday(){ var box=q('#todayList'); if(!box) return; box.innerHTML=''; var merged=[].concat(lists.today); var items=showAll? merged : merged.slice(0,3); if(!items.length){ box.innerHTML='<div class="sub">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É –≤—ã—à–µ</div>'; return } for(var i=0;i<items.length;i++){ box.appendChild(taskRow(items[i])) } }
  function renderPlan(){ var keys=['today','week','backlog']; for(var a=0;a<keys.length;a++){ var k=keys[a], box=q('#list-'+k); if(!box) continue; box.innerHTML=''; for(var i=0;i<lists[k].length;i++){ box.appendChild(taskRow(lists[k][i])) } } }
  function toggleAll(){ showAll=!showAll; var b=q('#toggleBtn'); if(b) b.textContent= showAll? '–°–∫—Ä—ã—Ç—å –ª–∏—à–Ω–µ–µ':'–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë'; renderToday() }

  // --- Calendar ---
  function renderAgenda(){ var hours=q('#hours'), slots=q('#slots'); if(!hours||!slots) return; hours.innerHTML=''; slots.innerHTML=''; var h; for(h=9;h<=18;h++){ var hr=document.createElement('div'); hr.className='hour'; hr.textContent=(h<10?'0':'')+h+':00'; hours.appendChild(hr); var sl=document.createElement('div'); sl.className='slot'; slots.appendChild(sl) } for(var i=0;i<events.length;i++){ var ev=events[i]; if(ev.date!==currentDate) continue; var top=((parseInt(ev.start.split(':')[0],10)-9)*40) + (parseInt(ev.start.split(':')[1],10)/60)*40 + 6; var height=(ev.dur/60)*40 - 12; var e=document.createElement('div'); e.className='event'; e.style.top=top+'px'; e.style.height=Math.max(28,height)+'px'; e.textContent=ev.title+' ¬∑ '+ev.start; slots.appendChild(e) } }
  function addEvent(){ var t=q('#evtTitle').value.trim(); var d=q('#calDate').value; var s=q('#evtStart').value||'10:00'; var dur=parseInt(q('#evtDur').value,10)||60; if(!d){ toast('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É'); return } if(!t){ toast('–ù–∞–∑–≤–∞–Ω–∏–µ –ø—É—Å—Ç–æ–µ'); return } events.push({id:Date.now(), date:d, start:s, dur:dur, title:t}); q('#evtTitle').value=''; save(); renderAgenda(); toast('–°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ') }

  // --- Chat (sheet) ---
  function appendMsg(who, text){ var box=q('#chatBox'); if(!box) return; var b=document.createElement('div'); b.className='bubble '+(who==='me'?'me':'bot'); b.textContent=text; box.appendChild(b); box.scrollTop=box.scrollHeight }
  function botReply(text){ var t=text.toLowerCase(); var out=''; if(t.indexOf('–∑–∞–¥–∞—á')>-1){ out='–ü—Ä–µ–¥–ª–∞–≥–∞—é —Ç–æ–ø‚Äë3 –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: 1) –ò–Ω—Ç–µ—Ä–≤—å—é (30–º–∏–Ω) 2) –ü—Ä–∞–≤–∫–∏ –ª–µ–Ω–¥–∏–Ω–≥–∞ (45–º–∏–Ω) 3) –ü–æ—Å—Ç‚Äë–∞–Ω–æ–Ω—Å (20–º–∏–Ω).'; } else if(t.indexOf('hadi')>-1||t.indexOf('–≥–∏–ø–æ—Ç–µ–∑')>-1){ out='HADI: H ‚Äî ¬´–ó–∞–≥–æ–ª–æ–≤–æ–∫ ‚Üë v2l –Ω–∞ 0.5–ø.–ø.¬ª; A ‚Äî A/B; D ‚Äî v2l; I ‚Äî 7 –¥–Ω–µ–π.'; } else if(t.indexOf('–∫–∞–ª–µ–Ω–¥–∞—Ä')>-1){ out='–î–æ–±–∞–≤—å—Ç–µ —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –Ω–∞–¥ —Å–µ—Ç–∫–æ–π: –Ω–∞–∑–≤–∞–Ω–∏–µ, –≤—Ä–µ–º—è, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.'; } else { out='–ú–æ–≥—É –ø–æ–º–æ—á—å —Å –ø–ª–∞–Ω–æ–º –¥–Ω—è, HADI –∏–ª–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—ë–º. –°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ.'; } setTimeout(function(){ appendMsg('bot', out) }, 250) }
  function openChat(){ q('#chatSheet').hidden=false }
  function closeChat(){ q('#chatSheet').hidden=true }
  function chatSend(){ var inp=q('#chatInput'); var v=(inp.value||'').trim(); if(!v) return; appendMsg('me', v); inp.value=''; botReply(v) }

  // --- Delegated events ---
  document.addEventListener('click', function(e){ var el=e.target; while(el&&el!==document){ if(el.getAttribute&&(el.getAttribute('data-action')||el.getAttribute('data-target')||el.getAttribute('data-list'))){ break } el=el.parentNode }
    if(!el||el===document) return;
    var act=el.getAttribute('data-action');
    if(act==='saveFocus'){ saveFocus(); e.preventDefault(); return }
    if(act==='quickAdd'){ quickAdd(); e.preventDefault(); return }
    if(act==='toggleAll'){ toggleAll(); e.preventDefault(); return }
    if(act==='addEvent'){ addEvent(); e.preventDefault(); return }
    if(act==='chatSend'){ chatSend(); e.preventDefault(); return }
    if(act==='openChat'){ openChat(); e.preventDefault(); return }
    if(act==='closeChat'){ closeChat(); e.preventDefault(); return }
    if(el.getAttribute('data-list')){ pickList(el); e.preventDefault(); return }
    var target=el.getAttribute('data-target'); if(target){ switchScreen(target, el.className.indexOf('seg')>-1?'.seg button':'.dock-item'); e.preventDefault(); return }
  });
  document.addEventListener('change', function(e){ var el=e.target; if(el&&el.id==='calDate'){ currentDate=el.value; renderAgenda() } });
  var addEl=q('#add'); if(addEl){ addEl.addEventListener('keydown', function(ev){ if(ev.key==='Enter'||ev.keyCode===13){ quickAdd() } }) }
  var chatEl=q('#chatInput'); if(chatEl){ chatEl.addEventListener('keydown', function(ev){ if(ev.key==='Enter'||ev.keyCode===13){ chatSend() } }) }

  // --- Init ---
  function init(){ load(); seed(); q('#calDate').value=currentDate; if(q('#focus')) q('#focus').value = focusText||''; updateFocusChip(); renderToday(); renderPlan(); renderAgenda(); switchScreen('today', '.dock-item') }
  init();
})();
</script>
<script>(function(){function qa(s){return document.querySelectorAll(s)}function q(s){return document.querySelector(s)}function switchScreen2(t,sel){var nodes=qa(sel||'.dock-item');for(var i=0;i<nodes.length;i++){nodes[i].classList.remove('active')}var btn=q((sel||'.dock-item')+'[data-target="'+t+'"]');if(btn){btn.classList.add('active')}var screens=qa('.screen');for(var j=0;j<screens.length;j++){screens[j].hidden=true}var scr=q('#screen-'+t);if(scr){scr.hidden=false}window.scrollTo(0,0)}window.switchScreen=switchScreen2;document.addEventListener('click',function(ev){var el=ev.target;while(el&&el!==document){if(el.getAttribute&&(el.getAttribute('data-target')||el.getAttribute('data-action'))){break}el=el.parentNode}if(!el||el===document)return;var tgt=el.getAttribute('data-target');if(tgt){switchScreen2(tgt,el.className.indexOf('seg')>-1?'.seg button':'.dock-item');ev.preventDefault()}var act=el.getAttribute('data-action');if(act==='quickAdd'){var i=q('#add');if(i&&i.value){var box=q('#todayList');if(box){var d=document.createElement('div');d.className='item';d.innerHTML='<div class=\"body\"><div class=\"title\">'+i.value+'</div></div>';box.insertBefore(d,box.firstChild);i.value=''}}ev.preventDefault()}if(act==='saveFocus'){ev.preventDefault()}if(act==='toggleAll'){var btn=q('#toggleBtn');if(btn){btn.textContent=(btn.textContent.indexOf('–ü–æ–∫–∞–∑–∞—Ç—å')>-1?'–°–∫—Ä—ã—Ç—å –ª–∏—à–Ω–µ–µ':'–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—ë')}ev.preventDefault()}})})();</script></body>
</html>
